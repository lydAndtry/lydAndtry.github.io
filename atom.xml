<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ€’æ”¾å§å¾·å¾·</title>
  
  <subtitle>ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº</subtitle>
  <link href="https://lydandtry.github.io/atom.xml" rel="self"/>
  
  <link href="https://lydandtry.github.io/"/>
  <updated>2023-06-24T07:11:29.738Z</updated>
  <id>https://lydandtry.github.io/</id>
  
  <author>
    <name>Liyongde</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼-åå°„æœºåˆ¶</title>
    <link href="https://lydandtry.github.io/posts/25987/"/>
    <id>https://lydandtry.github.io/posts/25987/</id>
    <published>2023-06-24T15:02:06.000Z</published>
    <updated>2023-06-24T07:11:29.738Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Javaè®¾è®¡æ¨¡å¼-åå°„æœºåˆ¶"><a href="#Javaè®¾è®¡æ¨¡å¼-åå°„æœºåˆ¶" class="headerlink" title="Javaè®¾è®¡æ¨¡å¼ - åå°„æœºåˆ¶"></a>Javaè®¾è®¡æ¨¡å¼ - åå°„æœºåˆ¶</h1><blockquote><p>&#x1f604; ä¸æ–­å­¦ä¹ æ‰æ˜¯ç‹é“<br>ğŸ”¥ ç»§ç»­è¸ä¸Šå­¦ä¹ ä¹‹è·¯ï¼Œå­¦ä¹‹åˆ†äº«ç¬”è®°<br>ğŸ‘Š æ€»æœ‰ä¸€å¤©æˆ‘ä¹Ÿèƒ½åƒå„ä½å¤§ä½¬ä¸€æ ·<br>ğŸ† å…³æ³¨æˆ‘çš„CSDNï¼š<a href="https://blog.csdn.net/qq_43843951?spm=1011.2415.3001.5343">ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº</a><br>ğŸ‘Š æ‰“ç®—è¿è½½Javaè®¾è®¡æ¨¡å¼ï¼Œè®°å½•è‡ªå·±çš„å­¦ä¹ å¿ƒå¾—ï¼Œåˆ†äº«å­¦ä¹ ç»éªŒã€‚</p></blockquote><h2 id="Javaåå°„æŠ€æœ¯"><a href="#Javaåå°„æŠ€æœ¯" class="headerlink" title="Javaåå°„æŠ€æœ¯"></a>Javaåå°„æŠ€æœ¯</h2><blockquote><p>åå°„çš„åº”ç”¨æœºåˆ¶å¹¿æ³›ï¼Œèƒ½å¤Ÿé…ç½®ç±»çš„å…¨é™å®šå(åŒ…å + ç±»å‹å)ã€æ–¹æ³•å’Œå‚æ•°ï¼Œå®Œæˆå¯¹è±¡çš„åˆå§‹åŒ–ï¼Œå¹¶ä¸”å¯ä»¥å¤§å¤§å¢å¼ºJavaçš„å¯é…ç½®æ€§ï¼ŒSpringIOCçš„åŸºæœ¬åŸç†å°±æ˜¯å¦‚æ­¤ã€‚</p><h3 id="1ã€é€šè¿‡åå°„æ„å»ºå¯¹è±¡"><a href="#1ã€é€šè¿‡åå°„æ„å»ºå¯¹è±¡" class="headerlink" title="1ã€é€šè¿‡åå°„æ„å»ºå¯¹è±¡"></a>1ã€é€šè¿‡åå°„æ„å»ºå¯¹è±¡</h3><p>åå°„æ„å»ºå¯¹è±¡å¯ä»¥æ˜¯æœ‰å‚å’Œæ— å‚ã€‚<br><strong>æ— å‚ï¼š</strong><br>å…ˆå®šä¹‰<strong>ReflectDemo</strong>ç±»ï¼Œå¹¶ä¸”æœ‰ä¸ªæ— å‚æ•°çš„æ–¹æ³•ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åå°„æœºåˆ¶ï¼ï¼ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡åå°„å»æ„å»ºå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡åå°„å»æ„å»º</span></span><br><span class="line"><span class="keyword">public</span> ReflectDemo <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ReflectDemo</span> <span class="variable">object</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        object = (ReflectDemo) Class.forName(<span class="string">&quot;com.lyd.demo.reflect.ReflectDemo&quot;</span>).newInstance();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯é€šè¿‡<strong>Class</strong>çš„<strong>forName()</strong>å»æ‰¾åˆ°è¿™ä¸ªç±»ï¼Œåœ¨é€šè¿‡<strong>newInstance()</strong>æ–¹æ³•åˆ›å»ºå®ä¾‹ã€‚<br>ç»™ç±»åŠ è½½å™¨å»æ³¨å†Œäº†ä¸€ä¸ªç±»<strong>ReflectDemo</strong>çš„å…¨é™å®šå</p><blockquote><p>object = (ReflectDemo) Class.forName(â€œcom.lyd.demo.reflect.ReflectDemoâ€).newInstance();</p></blockquote><p>å«å‚:<br>å…ˆå®šä¹‰<strong>ReflectParamDemo</strong>ç±»ï¼Œå¹¶ä¸”æœ‰ä¸ªå«å‚æ•°çš„æ–¹æ³•ä»¥åŠå…¶æ„é€ æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectParamDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ReflectParamDemo</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åå­—: &quot;</span> + name + <span class="string">&quot; å¹´é¾„: &quot;</span> + age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·ï¼Œæ ¹æ®Class.forNameå»åˆ›å»ºå®ä¾‹ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéœ€è¦åŠ ä¸Šå‚æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡åå°„å»æ„å»º</span></span><br><span class="line"><span class="keyword">public</span> ReflectParamDemo <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ReflectParamDemo</span> <span class="variable">object</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        object = (ReflectParamDemo) Class.forName(<span class="string">&quot;com.lyd.demo.reflect.ReflectParamDemo&quot;</span>)</span><br><span class="line">                .getConstructor(String.class, <span class="type">int</span>.class)</span><br><span class="line">                .newInstance(<span class="string">&quot;æå››&quot;</span>, <span class="number">18</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>getConstructor()ï¼Œå¸¦å…¥å‚æ•°ç±»å‹</p><blockquote><p>object = (ReflectParamDemo) Class.forName(â€œcom.lyd.demo.reflect.ReflectParamDemoâ€)<br>.getConstructor(String.class, int.class)<br>.newInstance(â€œæå››â€, 18);</p></blockquote><h3 id="2ã€åå°„æ–¹æ³•"><a href="#2ã€åå°„æ–¹æ³•" class="headerlink" title="2ã€åå°„æ–¹æ³•"></a>2ã€åå°„æ–¹æ³•</h3><p>æ— å‚ï¼š<br>æš‚æ—¶å…ˆæ¼”ç¤ºåå°„æ–¹æ³•ï¼Œæ‰€ä»¥ç”¨<strong>new</strong>çš„æ–¹æ³•æ¥åˆ›å»ºå®ä¾‹<strong>target</strong>ï¼Œå…·ä½“çš„ä»£ç è¯·çœ‹å®ä¾‹ï¼Œ é€šè¿‡<strong>ReflectDemo.class.getMethod(â€œsayHelloâ€);</strong>å¯ä»¥è·å–åˆ°ç±»ä¸­çš„æ–¹æ³•ï¼Œå¹¶ä¸”é€šè¿‡invoke<strong>åŠ ç²—æ ·å¼</strong>æ–¹æ³•å®Œæˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åå°„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">reflectMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">retuenObj</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">ReflectDemo</span> <span class="variable">target</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReflectDemo</span>();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectDemo.class.getMethod(<span class="string">&quot;sayHello&quot;</span>);</span><br><span class="line">        retuenObj = method.invoke(target);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> retuenObj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>target: æŒ‡å®šå¯¹è±¡<br>invoke(target)ï¼šè°ƒç”¨å“ªä¸ªå¯¹è±¡ä¸­çš„æ–¹æ³•ï¼Œå¦‚æœæ˜¯å«å‚çš„ï¼Œå¯ä»¥åœ¨åé¢æ·»åŠ å‚æ•°ï¼Œå¯ä»¥æ˜¯å¤šä¸ªå‚æ•°</p></blockquote><h3 id="3ã€å®ä¾‹ï¼š"><a href="#3ã€å®ä¾‹ï¼š" class="headerlink" title="3ã€å®ä¾‹ï¼š"></a>3ã€å®ä¾‹ï¼š</h3><p>ç»¼åˆåå°„å¯¹è±¡ä¸æ–¹æ³•<br>æ— å‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®ä¾‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">reflect</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ReflectDemo</span> <span class="variable">object</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        object = (ReflectDemo) Class.forName(<span class="string">&quot;com.lyd.demo.reflect.ReflectDemo&quot;</span>).newInstance();</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectDemo.class.getMethod(<span class="string">&quot;sayHello&quot;</span>);</span><br><span class="line">        method.invoke(object);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å«å‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®ä¾‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">reflect</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ReflectParamDemo</span> <span class="variable">object</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        object = (ReflectParamDemo) Class.forName(<span class="string">&quot;com.lyd.demo.reflect.ReflectParamDemo&quot;</span>)</span><br><span class="line">                .getConstructor(String.class, <span class="type">int</span>.class)</span><br><span class="line">                .newInstance(<span class="string">&quot;æå››&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectParamDemo.class.getMethod(<span class="string">&quot;sayHello&quot;</span>, String.class, <span class="type">int</span>.class);</span><br><span class="line">        method.invoke(object, <span class="string">&quot;æå››&quot;</span>, <span class="number">18</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ä½“ä»£ç "><a href="#æ€»ä½“ä»£ç " class="headerlink" title="æ€»ä½“ä»£ç "></a>æ€»ä½“ä»£ç </h2><p>ReflectDemoï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.reflect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: åå°„æœºåˆ¶-æ— å‚æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åå°„æœºåˆ¶ï¼ï¼ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡åå°„å»æ„å»º</span></span><br><span class="line">    <span class="keyword">public</span> ReflectDemo <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ReflectDemo</span> <span class="variable">object</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            object = (ReflectDemo) Class.forName(<span class="string">&quot;com.lyd.demo.reflect.ReflectDemo&quot;</span>).newInstance();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åå°„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">reflectMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">retuenObj</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ReflectDemo</span> <span class="variable">target</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReflectDemo</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectDemo.class.getMethod(<span class="string">&quot;sayHello&quot;</span>);</span><br><span class="line">            retuenObj = method.invoke(target);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> retuenObj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®ä¾‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">reflect</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ReflectDemo</span> <span class="variable">object</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            object = (ReflectDemo) Class.forName(<span class="string">&quot;com.lyd.demo.reflect.ReflectDemo&quot;</span>).newInstance();</span><br><span class="line">            <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectDemo.class.getMethod(<span class="string">&quot;sayHello&quot;</span>);</span><br><span class="line">            method.invoke(object);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ReflectParamDemoï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.reflect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: åå°„æœºåˆ¶-å¸¦å‚æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectParamDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ReflectParamDemo</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åå­—: &quot;</span> + name + <span class="string">&quot; å¹´é¾„: &quot;</span> + age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡åå°„å»æ„å»º</span></span><br><span class="line">    <span class="keyword">public</span> ReflectParamDemo <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ReflectParamDemo</span> <span class="variable">object</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            object = (ReflectParamDemo) Class.forName(<span class="string">&quot;com.lyd.demo.reflect.ReflectParamDemo&quot;</span>)</span><br><span class="line">                    .getConstructor(String.class, <span class="type">int</span>.class)</span><br><span class="line">                    .newInstance(<span class="string">&quot;æå››&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®ä¾‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">reflect</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ReflectParamDemo</span> <span class="variable">object</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            object = (ReflectParamDemo) Class.forName(<span class="string">&quot;com.lyd.demo.reflect.ReflectParamDemo&quot;</span>)</span><br><span class="line">                    .getConstructor(String.class, <span class="type">int</span>.class)</span><br><span class="line">                    .newInstance(<span class="string">&quot;æå››&quot;</span>, <span class="number">18</span>);</span><br><span class="line">            <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectParamDemo.class.getMethod(<span class="string">&quot;sayHello&quot;</span>, String.class, <span class="type">int</span>.class);</span><br><span class="line">            method.invoke(object, <span class="string">&quot;æå››&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼šReflectTest</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.reflect;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: åå°„æœºåˆ¶æµ‹è¯•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ReflectDemo.reflect();</span><br><span class="line">        ReflectParamDemo.reflect();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç»“æœ:<br><img src="https://s2.loli.net/2023/06/24/F39akm5z4SctlDY.png" alt="æˆªå›¾.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Javaè®¾è®¡æ¨¡å¼-åå°„æœºåˆ¶&quot;&gt;&lt;a href=&quot;#Javaè®¾è®¡æ¨¡å¼-åå°„æœºåˆ¶&quot; class=&quot;headerlink&quot; title=&quot;Javaè®¾è®¡æ¨¡å¼ - åå°„æœºåˆ¶&quot;&gt;&lt;/a&gt;Javaè®¾è®¡æ¨¡å¼ - åå°„æœºåˆ¶&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;&amp;#x1f604;</summary>
      
    
    
    
    <category term="Javaè®¾è®¡æ¨¡å¼" scheme="https://lydandtry.github.io/categories/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://lydandtry.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="Java" scheme="https://lydandtry.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>é”çš„æœºåˆ¶ä¸åº•å±‚ä¼˜åŒ–åŸç†</title>
    <link href="https://lydandtry.github.io/posts/53870/"/>
    <id>https://lydandtry.github.io/posts/53870/</id>
    <published>2023-06-19T20:13:33.000Z</published>
    <updated>2023-06-24T07:11:29.738Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ã€å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘ã€‘-é”çš„æœºåˆ¶ä¸åº•å±‚ä¼˜åŒ–åŸç†"><a href="#ã€å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘ã€‘-é”çš„æœºåˆ¶ä¸åº•å±‚ä¼˜åŒ–åŸç†" class="headerlink" title="ã€å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘ã€‘- é”çš„æœºåˆ¶ä¸åº•å±‚ä¼˜åŒ–åŸç†"></a>ã€å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘ã€‘- é”çš„æœºåˆ¶ä¸åº•å±‚ä¼˜åŒ–åŸç†</h1><p><img src="https://s2.loli.net/2023/06/21/8OdFqoz1WukpYaS.jpg" alt="é”çš„æœºåˆ¶ä¸åº•å±‚ä¼˜åŒ–åŸç†.jpg"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘ç»å¸¸ç ”ç©¶ä¸€äº›å…³äºçº¿ç¨‹å¹¶å‘çš„é—®é¢˜ï¼Œå†å¼€å‘ä¸­ä¹Ÿå®å®åœ¨åœ¨é‡åˆ°è¿‡è®¸å¤šçš„å¹¶å‘é—®é¢˜ï¼Œä¹‹å‰æ‰€å­¦çš„æ˜¯å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ï¼Œç„¶è€Œæ¥ä¸‹æ¥å°±å¾—ç†è§£ä¸€ä¸‹åº•å±‚åŸç†ã€‚</p><h2 id="ç®€å•ä¾‹å­"><a href="#ç®€å•ä¾‹å­" class="headerlink" title="ç®€å•ä¾‹å­"></a>ç®€å•ä¾‹å­</h2><p>é¦–å…ˆç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¿›è¡Œå¯¹é”çš„å¼€ç¯‡è®¤çŸ¥ã€‚</p><p>å¦‚ä¸‹ä»£ç ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±»ï¼Œåœ¨è¿™ä¸ªç±»ä¸­æä¾›äº†ä¸€ä¸ªè‡ªå¢çš„æ–¹æ³•ã€‚æˆ‘ä»¬é€šè¿‡å¤šçº¿ç¨‹çš„æ–¹å¼å»æ‰§è¡Œè‡ªå¢ï¼Œå¹¶ä¸”ä¸»çº¿ç¨‹ä¹ŸåŠ å…¥è¿›è¡Œè‡ªå¢ï¼Œæœ€åè¾“å‡ºè¿™ä¸ªå€¼ã€‚è¿™æ®µä»£ç éƒ½çŸ¥é“åœ¨è‡ªå¢çš„æ—¶å€™ä¼šå‡ºç°å¹¶å‘é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨é€šè¿‡åŠ é”ï¼Œæ§åˆ¶å¯¹äº’æ–¥èµ„æºçš„è®¿é—®ï¼Œæœ€åå°±èƒ½å¾—åˆ°æœŸæœ›çš„å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Number</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNum</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoAccretion</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="built_in">this</span>) &#123;</span><br><span class="line">            num++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestNum</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Number</span> <span class="variable">number</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Number</span>();</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000000</span>; i++) &#123;</span><br><span class="line">                number.autoAccretion(); <span class="comment">// è‡ªå¢</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        thread.start();</span><br><span class="line">        <span class="comment">// ä¸»çº¿ç¨‹ä¹Ÿæ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000000</span>; i++) &#123;</span><br><span class="line">            number.autoAccretion();</span><br><span class="line">        &#125;</span><br><span class="line">        thread.join();</span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(String.format(<span class="string">&quot;%sms&quot;</span>, endTime - startTime));</span><br><span class="line">        System.out.println(number.num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡æ‰§è¡Œä¼šå‘ç°ï¼Œè¿™ä¸ªå€¼å¹¶ä¸æ˜¯æˆ‘ä»¬æœŸæœ›æ‰€å¾—åˆ°çš„ï¼Œè¿™æ˜¯å› ä¸ºè¿™é‡Œé¢å‡ºç°äº†å¹¶å‘çš„é—®é¢˜ã€‚</p><p><img src="https://s2.loli.net/2023/06/21/Xwq4smxauUvz1ZV.png" alt="image-20230603143159955.png"></p><p>å½“ç„¶ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“è¦æƒ³è§£å†³è¿™ä¸ªå¹¶å‘é—®é¢˜ï¼Œåªéœ€è¦åœ¨è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ä¸ŠåŠ ä¸Š<code>synchronized</code> å°±è¡Œã€‚</p><h2 id="é”çš„æœºåˆ¶"><a href="#é”çš„æœºåˆ¶" class="headerlink" title="é”çš„æœºåˆ¶"></a>é”çš„æœºåˆ¶</h2><p>é€šè¿‡ä»¥ä¸Šä»£ç ï¼Œæˆ‘ä»¬ä½¿ç”¨synchronizedé”æ¥æ§åˆ¶å¯¹num++çš„æ‰§è¡Œï¼Œå½“å¤šä¸ªçº¿ç¨‹è¿›æ¥çš„æ—¶å€™ï¼Œåªæœ‰ä¸€ä¸ªé”èƒ½æ‹¿åˆ°synchronizedè¿™æŠŠé”ã€‚</p><h3 id="1ã€jdk1-6ä¹‹å‰"><a href="#1ã€jdk1-6ä¹‹å‰" class="headerlink" title="1ã€jdk1.6ä¹‹å‰"></a>1ã€jdk1.6ä¹‹å‰</h3><p>åœ¨jdk1.6ä»¥å‰ï¼ŒçœŸæ­£åŠ é”çš„å¯¹è±¡æ˜¯synchronizedå†…éƒ¨çš„monitorå¯¹è±¡[1]ï¼›é‚£ä¹ˆï¼Œå¦‚æœæ‹¿ä¸åˆ°synchronizedé”çš„çº¿ç¨‹æœ€åä¼šæ˜¯æ€æ ·çš„å‘¢ï¼Ÿä»–ä¼šæ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼ˆå³é‡é‡çº§é”ï¼‰ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾åæ‰èƒ½è®©ä¸‹ä¸ªçº¿ç¨‹æ‹¿åˆ°é”ï¼Œè¿™æ˜¯jdk1.6ä»¥å‰çš„åšæ³•ï¼Œå¦‚æœä¸€ç›´ä¸é‡Šæ”¾é”ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´è¿™äº›ç­‰å¾…çº¿ç¨‹ä¸€ç›´å¤„äºç­‰å¾…ï¼Œå¾ˆæ˜æ˜¾è¿™æ ·ä¼šå¯¼è‡´æ€§èƒ½çš„é—®é¢˜ã€‚</p><p>åœ¨æ¥è¯´ä¸€ä¸‹é‡é‡çº§é”ï¼Œåœ¨åº•å±‚å¯èƒ½å‡ºç°çº¿ç¨‹é˜»å¡ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œç­‰å¾…å¾—åˆ°é”çš„çº¿ç¨‹å°†é”é‡Šæ”¾æ‰ï¼Œé€šè¿‡æ“ä½œç³»ç»Ÿå¯¹çº¿ç¨‹çš„è°ƒåº¦ï¼Œå°†é˜»å¡æ€çš„çº¿ç¨‹å”¤é†’ã€‚æ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹çš„åˆ‡æ¢è¿˜éœ€è¦ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°æ ¸å¿ƒæ€ï¼Œæˆæœ¬éå¸¸é«˜ã€‚</p><blockquote><p>[1]åœ¨æ“ä½œç³»ç»Ÿå’Œå¹¶å‘ç¼–ç¨‹é¢†åŸŸä¸­ï¼ŒMonitorï¼ˆç›‘è§†å™¨ï¼‰æ˜¯ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œç”¨äºæ§åˆ¶å¯¹å…±äº«èµ„æºçš„è®¿é—®ã€‚å®ƒå¯ä»¥ç”¨äºç¡®ä¿åœ¨ä»»ä½•æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¿›å…¥ä¸´ç•ŒåŒºï¼ˆCritical Sectionï¼‰å¹¶æ‰§è¡Œç›¸å…³æ“ä½œï¼Œä»è€Œå®ç°çº¿ç¨‹å®‰å…¨ã€‚</p></blockquote><p><img src="https://s2.loli.net/2023/06/21/nXSZyt19IWE8khG.png" alt="çº¿ç¨‹é”1.png"></p><h3 id="2ã€CASæœºåˆ¶"><a href="#2ã€CASæœºåˆ¶" class="headerlink" title="2ã€CASæœºåˆ¶"></a>2ã€CASæœºåˆ¶</h3><p>CASï¼ˆCompare and Swapï¼‰ç®€å•è¯´å°±æ˜¯æ¯”è¾ƒå¹¶äº¤æ¢ï¼Œå®ƒæ˜¯ä¸€ç§å¹¶å‘ç¼–ç¨‹ä¸­å¸¸ç”¨çš„åŸå­æ“ä½œï¼Œç”¨äºå®ç°æ— é”çš„çº¿ç¨‹å®‰å…¨æ“ä½œã€‚å®ƒé€šå¸¸ç”¨äºè§£å†³å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹åŒä¸€ä¸ªå…±äº«å˜é‡è¿›è¡Œä¿®æ”¹çš„ç«äº‰é—®é¢˜ã€‚æˆ‘ä»¬é€šå¸¸å°†casç§°ä¸ºæ— é”ã€è‡ªæ—‹é”ã€ä¹è§‚é”ä»¥åŠè½»é‡çº§é”ã€‚</p><blockquote><p>CASæ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°ï¼šå†…å­˜ä½ç½®ï¼ˆæˆ–ç§°ä¸ºæœŸæœ›å€¼ï¼‰ï¼Œå½“å‰å€¼å’Œæ–°å€¼ã€‚CASæ“ä½œä¼šæ¯”è¾ƒå†…å­˜ä½ç½®çš„å½“å‰å€¼ä¸æœŸæœ›å€¼æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™å°†å†…å­˜ä½ç½®çš„å€¼æ›´æ–°ä¸ºæ–°å€¼ï¼›å¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™ä¸è¿›è¡Œä»»ä½•æ“ä½œã€‚CASæ“ä½œæ˜¯åŸå­çš„ï¼Œå³åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹ä¸­æ–­ã€‚å®ƒé€šè¿‡æ¯”è¾ƒå½“å‰å€¼å’ŒæœŸæœ›å€¼æ¥ç¡®å®šå†…å­˜ä½ç½®æ˜¯å¦è¢«ä¿®æ”¹ï¼Œä»è€Œé¿å…äº†ä¼ ç»Ÿçš„é”æœºåˆ¶å¸¦æ¥çš„ç«äº‰å’Œé˜»å¡ã€‚</p></blockquote><p>CASçš„å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š</p><p>â€‹        â‘ è·å–å†…å­˜ä¸­çš„åŸå§‹å€¼ï¼Œå³å¤‡ä»½æ•°æ®ã€‚</p><p>â€‹        â‘¡è¿›è¡Œæ¯”è¾ƒï¼Œå°†å½“å‰å€¼ä¸æœŸæœ›å€¼è¿›è¡Œæ¯”å¯¹çœ‹æ˜¯å¦ç›¸ç­‰ã€‚</p><p>â€‹        â‘¢å¦‚æœç›¸ç­‰ï¼Œå°±å°†å½“å‰å€¼è¦†ç›–æ—§çš„å€¼ï¼Œåä¹‹é€šè¿‡å¾ªç¯ï¼Œé‡å¤æ“ä½œï¼Œç›´åˆ°è·å¾—åˆ°å¯¹çš„å€¼ã€‚</p><p>æˆ‘ä»¬æœ€å¸¸è§çš„AtomicIntegerç±»ï¼Œä»–å°±æ˜¯å±äºåŸå­æ€§æ“ä½œçš„ï¼Œå®ƒå¯ä»¥åœ¨å¹¶å‘ç¯å¢ƒä¸‹è¿›è¡ŒåŸå­æ“ä½œï¼Œç¡®ä¿å¯¹æ•´æ•°çš„æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚ä¸‹ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªç±»çš„è‡ªå¢æ–¹æ³•æ¥æ›¿æ¢ç”¨synchronizedé”åŒ…å›´çš„è‡ªå¢è¿ç®—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoAccretion</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//        synchronized (this) &#123;</span></span><br><span class="line">    <span class="comment">//            num++;</span></span><br><span class="line">    <span class="comment">//        &#125;</span></span><br><span class="line">    atomicInteger.incrementAndGet();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹å®ƒçš„åº•å±‚ä»£ç ï¼Œé€šè¿‡unsafeç±»è°ƒç”¨è‡ªå¢æ–¹æ³•ï¼Œå®é™…åº•å±‚åŸç†ä¹Ÿæ˜¯è¿›è¡Œæ¯”è¾ƒäº¤æ¢çš„è§„åˆ™æ¥ä¿è¯åŸå­æ€§ã€‚ä¼šå…ˆè·å–å†…éƒ¨åŸå§‹çš„å€¼ï¼Œåœ¨å°†è¿™ä¸ªå€¼è‡ªå¢1ï¼Œåœ¨è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå½“å‰å€¼ç­‰äºæœŸæœ›å€¼ï¼Œåˆ™è‡ªåŠ¨å°†å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ¯”è¾ƒä¸ç›¸ç­‰ï¼Œå¯èƒ½æ˜¯åœ¨è·å–åŸå§‹å€¼ä¹‹ååšè‡ªå¢çš„æ—¶å€™ï¼ŒåŸå§‹å€¼å·²ç»è¢«å…¶ä»–çº¿ç¨‹ç»™æ“ä½œæˆåŠŸè¦†ç›–äº†ï¼Œåˆ™è¿™ä¸ªæ–°çš„å€¼æ˜¯é”™è¯¯ï¼Œéœ€è¦åˆ·æ–°å¤‡ä»½æ•°æ®ï¼Œå†å»å¾ªç¯å°è¯•ï¼Œç›´åˆ°å¾—åˆ°å¯¹çš„æ•°æ®æ‰ä¼šå»åˆ·æ–°æ—§å€¼ã€‚å¤§é‡çš„çº¿ç¨‹è¿‡æ¥æ‰§è¡Œè¿™ä¸ªcompareAndSetæ–¹æ³•ï¼Œå¦‚æœåœ¨æ‰§è¡Œçš„æ—¶å€™æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹æ‰§è¡Œï¼Œé‚£å°±èƒ½å¤Ÿå°†æ–°çš„å€¼å°†æ—§çš„å€¼æ›¿æ¢æ‰ï¼Œå°±ç®—è¯´æ˜¯å¤±è´¥äº†ï¼Œèƒ½å¤Ÿé€šè¿‡å¾ªç¯ç»§ç»­æ‰§è¡Œï¼Œåœ¨å¤šçº¿ç¨‹çš„æ‰§è¡Œèƒ½å¤Ÿç¡®ä¿æ•°æ®çš„æ­£ç¡®æ€§ï¼Œè‡³äºçº¿ç¨‹çš„å…ˆåæ‰§è¡Œä¹Ÿåªæ˜¯çœ‹è¿æ°”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">incrementAndGet</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> unsafe.getAndAddInt(<span class="built_in">this</span>, valueOffset, <span class="number">1</span>) + <span class="number">1</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//unsafe.class</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndAddInt</span><span class="params">(Object var1, <span class="type">long</span> var2, <span class="type">int</span> var4)</span> &#123;</span><br><span class="line">    <span class="type">int</span> var5;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        var5 = <span class="built_in">this</span>.getIntVolatile(var1, var2);</span><br><span class="line">    &#125; <span class="keyword">while</span>(!<span class="built_in">this</span>.compareAndSwapInt(var1, var2, var5, var5 + var4)); <span class="comment">// æœ€åçš„åº•å±‚åŸç†é€šè¿‡å¾ªç¯è‡ªå¤‡ä»½ï¼Œè‡ªå¢ä¸æ¯”è¾ƒ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> var5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å†…éƒ¨ä»£ç æ˜¯çœ‹ä¸åˆ°çš„ï¼Œå®ƒåº•å±‚æ˜¯é€šè¿‡c++ç¼–å†™çš„ã€‚Javaä¸­çš„CASæ“ä½œéƒ½æ˜¯é€šè¿‡sunåŒ…ä¸‹Unsafeç±»å®ç°ï¼Œè€ŒUnsafeç±»ä¸­çš„æ–¹æ³•éƒ½æ˜¯nativeæ–¹æ³•ï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•çš„å®ç°æ˜¯ç”±å¤–éƒ¨çš„æœ¬åœ°ä»£ç ï¼Œè¿™é‡Œæˆ‘ä¸‹è½½äº†lookaside_java-1.8.0-openjdkçš„æºç (å¯ä»¥ä»githubä¸Šæ‹‰å–)ï¼Œå¯ä»¥ä»hoståº•å±‚æ¥çœ‹æºç ã€‚</p><p><img src="https://s2.loli.net/2023/06/21/tV47NXn3DfHAEK8.png" alt="image-20230612205419845.png"></p><p>å°±AtomicIntegerå†…çš„compareAndSwapIntæ–¹æ³•ï¼Œæˆ‘ä»¬é€šè¿‡jdk1.8çš„ <code>hotspot/src/share/vm/prims/unsafe.cpp</code> ä¸‹çš„æºç å¯ä»¥çœ‹åˆ°åº•å±‚ç”±c++ç¼–å†™ã€‚å®ƒä½¿ç”¨åŸå­æ¯”è¾ƒå’Œäº¤æ¢æ“ä½œæ¥æ¯”è¾ƒå’Œæ›¿æ¢æŒ‡å®šå†…å­˜åœ°å€ä¸Šçš„æ•´æ•°å€¼ï¼Œå¹¶è¿”å›æ¯”è¾ƒç»“æœã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UNSAFE_ENTRY</span>(jboolean, <span class="built_in">Unsafe_CompareAndSwapInt</span>(JNIEnv *env, jobject unsafe, jobject obj, jlong offset, jint e, jint x))</span><br><span class="line">  <span class="built_in">UnsafeWrapper</span>(<span class="string">&quot;Unsafe_CompareAndSwapInt&quot;</span>);</span><br><span class="line">  <span class="comment">// We are about to write to this entry so check to see if we need to copy it.</span></span><br><span class="line">  <span class="comment">// æ‰§è¡Œäº†ä¸€ä¸ªå†™å±éšœæ“ä½œï¼ˆwrite barrierï¼‰ï¼Œç”¨äºä¿è¯åœ¨ä¿®æ”¹å¯¹è±¡ä¹‹å‰è¿›è¡Œå¿…è¦çš„å¤„ç†ã€‚</span></span><br><span class="line">  <span class="comment">// JNIHandles::resolve(obj)å°†objä»JNIå¥æŸ„è§£æä¸ºJavaå¯¹è±¡ï¼Œå¹¶ä½¿ç”¨oopDesc::bs()æ‰§è¡Œå†™å±éšœæ“ä½œã€‚</span></span><br><span class="line">  oop p = oopDesc::<span class="built_in">bs</span>()-&gt;<span class="built_in">write_barrier</span>(JNIHandles::<span class="built_in">resolve</span>(obj));</span><br><span class="line">  jint* addr = (jint *) <span class="built_in">index_oop_from_field_offset_long</span>(p, offset);<span class="comment">// è®¡ç®—å‡ºè¦è¿›è¡ŒåŸå­æ¯”è¾ƒå’Œäº¤æ¢æ“ä½œçš„å†…å­˜åœ°å€</span></span><br><span class="line">  <span class="keyword">return</span> (jint)(Atomic::<span class="built_in">cmpxchg</span>(x, addr, e)) == e; <span class="comment">// æ ¸å¿ƒä»£ç  æ‰§è¡ŒåŸå­çš„æ¯”è¾ƒå’Œäº¤æ¢æ“ä½œ</span></span><br><span class="line">UNSAFE_END</span><br></pre></td></tr></table></figure><blockquote><p><strong>(jint)(Atomic::cmpxchg(x, addr, e)) == e;</strong>: è¿™ä¸€è¡Œä»£ç æ˜¯ä¸»è¦çš„æ ¸å¿ƒä»£ç ï¼Œä½¿ç”¨<strong>Atomic::cmpxchg</strong>å‡½æ•°æ‰§è¡ŒåŸå­çš„æ¯”è¾ƒå’Œäº¤æ¢æ“ä½œã€‚å®ƒå°è¯•å°†<strong>addr</strong>æŒ‡å‘çš„å†…å­˜åœ°å€ä¸Šçš„å€¼ä¸eè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™å°†å…¶æ›¿æ¢ä¸ºxã€‚æœ€åï¼Œå®ƒå°†æ¯”è¾ƒç»“æœä¸eè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚</p></blockquote><p>æ¥ä¸‹æ¥åœ¨jdk1.8çš„æºç ï¼šatomic_linux_x86.inline.hppä¸­çœ‹ä¸€ä¸‹è¿™ä¸ªæ ¸å¿ƒä»£ç çš„åº•å±‚é€»è¾‘ï¼Œè¿™æ®µä»£ç ä¼šå…ˆé€šè¿‡æ“ä½œç³»ç»Ÿçš„å†…æ ¸æ–¹æ³•åˆ¤æ–­æ˜¯å¦ä¸ºå¤šå¤„ç†å™¨ç³»ç»Ÿï¼Œåœ¨é€šè¿‡LOCK_IF_MPè·å–lockæŒ‡ä»¤ï¼Œå®é™…ä¸Šæ‹¿åˆ°çš„æ±‡ç¼–æŒ‡ä»¤lockä¸cmpxchglæ¥å®ç°åŸå­æ€§ã€‚å½“æ‹¿åˆ°lockæŒ‡ä»¤çš„æ—¶å€™å°±èƒ½ç»™è¿›è¡Œæ¯”è¾ƒå¹¶äº¤æ¢ï¼Œæ²¡æœ‰å¾—åˆ°é”çš„æƒ…å†µéœ€è¦ç­‰å¾…é”è¢«é‡Šæ”¾ï¼Œè¿™å°±è¾¾åˆ°äº†åŸå­æ€§é—®é¢˜ã€‚å½“ç¼“å­˜ä¸æ˜¯å¾ˆå¤§çš„æƒ…å†µæ˜¯ä½¿ç”¨ç¼“å­˜è¡Œé”ï¼Œä½†å¦‚æœè¶…è¿‡äº†ç¼“å­˜è¡Œå¤§å°ï¼Œå°±ä¼šä½¿ç”¨æ€»çº¿é”ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> jint <span class="title">Atomic::cmpxchg</span> <span class="params">(jint exchange_value, <span class="keyword">volatile</span> jint* dest, jint compare_value)</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> mp = os::<span class="built_in">is_MP</span>(); <span class="comment">// è°ƒç”¨æ“ä½œç³»ç»Ÿå†…æ ¸æ–¹æ³•ç”¨äºåˆ¤æ–­å½“å‰çš„ç³»ç»Ÿæ˜¯å¦ä¸ºå¤šå¤„ç†å™¨ç³»ç»Ÿã€‚</span></span><br><span class="line">  <span class="comment">// LOCK_IF_MPè·å–lockæŒ‡ä»¤ï¼Œä»–æ˜¯åˆ¤æ–­æ˜¯å¦ä½å¤šå¤„ç†å™¨</span></span><br><span class="line">  <span class="function">__asm__ <span class="title">volatile</span> <span class="params">(LOCK_IF_MP(%<span class="number">4</span>) <span class="string">&quot;cmpxchgl %1,(%3)&quot;</span> <span class="comment">// æ±‡ç¼–æŒ‡ä»¤ï¼Œå‰é¢å·²ç»å®šä¹‰#define LOCK_IF_MP(mp) &quot;cmp $0, &quot; #mp &quot;; je 1f; lock; 1: &quot;</span></span></span></span><br><span class="line"><span class="params"><span class="function">                    : <span class="string">&quot;=a&quot;</span> (exchange_value)</span></span></span><br><span class="line"><span class="params"><span class="function">                    : <span class="string">&quot;r&quot;</span> (exchange_value), <span class="string">&quot;a&quot;</span> (compare_value), <span class="string">&quot;r&quot;</span> (dest), <span class="string">&quot;r&quot;</span> (mp)</span></span></span><br><span class="line"><span class="params"><span class="function">                    : <span class="string">&quot;cc&quot;</span>, <span class="string">&quot;memory&quot;</span>)</span></span>;</span><br><span class="line">  <span class="keyword">return</span> exchange_value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Synchronizedåº•å±‚çš„é”ä¼˜åŒ–æœºåˆ¶"><a href="#Synchronizedåº•å±‚çš„é”ä¼˜åŒ–æœºåˆ¶" class="headerlink" title="Synchronizedåº•å±‚çš„é”ä¼˜åŒ–æœºåˆ¶"></a>Synchronizedåº•å±‚çš„é”ä¼˜åŒ–æœºåˆ¶</h2><h3 id="1ã€é”çš„çŠ¶æ€å‡çº§å˜è¿"><a href="#1ã€é”çš„çŠ¶æ€å‡çº§å˜è¿" class="headerlink" title="1ã€é”çš„çŠ¶æ€å‡çº§å˜è¿"></a>1ã€é”çš„çŠ¶æ€å‡çº§å˜è¿</h3><p>åœ¨jdk1.6ä»¥åSynchronizedé”å¼•ç”¨äº†è®¸å¤šçŠ¶æ€åˆ‡æ¢ï¼šæ— çŠ¶æ€ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ï¼Œæ ¹æ®ä¸åŒçš„æ¡ä»¶è¿›è¡ŒçŠ¶æ€çš„åˆ‡æ¢å‡çº§ï¼Œèƒ½å¤Ÿåœ¨ä¸€å®šçš„ç¨‹åº¦ä¸­ä½¿æ€§èƒ½æå‡ã€‚</p><h4 id="1-ã€é”çŠ¶æ€mark-wordç»“æ„"><a href="#1-ã€é”çŠ¶æ€mark-wordç»“æ„" class="headerlink" title="(1)ã€é”çŠ¶æ€mark wordç»“æ„"></a>(1)ã€é”çŠ¶æ€mark wordç»“æ„</h4><p>synchronizedé”åœ¨çº¿ç¨‹ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯æ²¡æœ‰åŠ é”çš„ï¼Œåªæ˜¯åœ¨mark wordä¸­è®°å½•äº†çº¿ç¨‹IDï¼Œè¿™ç§å°±æ˜¯åå‘é”ï¼Œé»˜è®¤æ˜¯è®¤ä¸ºä¸ä¼šæœ‰å¤šä¸ªçº¿ç¨‹æŠ¢ç€ç”¨ï¼Œmark wordæ˜¯é€šè¿‡64bitæ¥è¡¨ç¤ºçš„ï¼Œé€šè¿‡æœ€ä½2ä½ä¹Ÿå°±æ˜¯é”æ ‡å¿—ä½ï¼Œåå‘é”ä¸æ— é”çš„å€¼æ˜¯01ï¼Œè½»é‡çº§é”ç”¨00è¡¨ç¤ºï¼Œé‡é‡çº§é”ç”¨10è¡¨ç¤ºï¼Œæ ‡è®°äº†GCçš„ç”¨11è¡¨ç¤ºï¼Œæ— é”ä¸åå‘é”ä½2ä½æ˜¯ä¸€è‡´çš„ï¼Œåœ¨å€’æ•°ç¬¬3ä½æœ‰1ä½æ¥è¡¨ç¤ºåå‘é”ä½ï¼šå€¼ä¸º1è¡¨ç¤ºåå‘é”ã€‚</p><p><img src="https://s2.loli.net/2023/06/21/Poki3GF5W2RDEHb.png" alt="image-20230613131954515.png"></p><h4 id="2-ã€é”å‡çº§æµç¨‹"><a href="#2-ã€é”å‡çº§æµç¨‹" class="headerlink" title="(2)ã€é”å‡çº§æµç¨‹"></a>(2)ã€é”å‡çº§æµç¨‹</h4><p>åœ¨Javaä¸­ï¼Œsynchronizedé”çš„çŠ¶æ€å¯ä»¥æ ¹æ®ç«äº‰æƒ…å†µè¿›è¡Œå‡çº§å’Œé™çº§,ç»“åˆä¸Šå›¾ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¸…æ™°çš„äº†è§£synchronizedåº•å±‚é”çš„çŠ¶æ€å˜åŒ–è¿‡ç¨‹ã€‚</p><p>åˆå§‹çŠ¶æ€ä¸‹ï¼Œå¯¹è±¡æ²¡æœ‰è¢«ä»»ä½•çº¿ç¨‹é”å®šï¼Œæ­¤æ—¶æ˜¯æ— çŠ¶æ€é”ï¼›å½“æœ‰ä¸€ä¸ªçº¿ç¨‹ç¬¬ä¸€æ¬¡è¿›å…¥synchronizedä»£ç å—æ—¶ï¼ŒJVMä¼šåå‘è¯¥çº¿ç¨‹ï¼Œå°†é”çš„å¯¹è±¡å¤´æ ‡è®°ä¸ºåå‘é”ï¼Œæ­¤æ—¶è¿˜ä¼šè®°å½•è¿™ä¸ªçº¿ç¨‹IDï¼Œèƒ½å¤Ÿç›´æ¥è¿›å…¥åŒæ­¥å—ï¼Œæ ‡è®°åå‘çº¿ç¨‹idæ˜¯ä¸ºäº†ç­‰ä¸‹æ¬¡çº¿ç¨‹è¿‡æ¥è®¿é—®çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œçº¿ç¨‹idæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒï¼Œå°±èƒ½å¤Ÿè·å–è¿™æŠŠé”ï¼›ç„¶è€Œï¼Œå½“å¤šä¸ªçº¿ç¨‹æ¥äº‰æŠ¢è¿™æŠŠé”ï¼Œè¿™æ—¶å€™å°±ä¼šè¿›è¡Œé”å‡çº§ï¼Œä¼šå°†åå‘é”å‡çº§ä¸ºè½»é‡çº§é”ï¼Œå®ƒä¼šä½¿ç”¨CASæ“ä½œæ¥å°è¯•å°†é”çš„å¯¹è±¡å¤´è®¾ç½®ä¸ºæŒ‡å‘é”è®°å½•ï¼ˆLock Recordï¼‰çš„æŒ‡é’ˆï¼Œå¦‚æœCASæˆåŠŸï¼Œå°±èƒ½å¤Ÿè·å¾—è¿™æŠŠé”ï¼Œå¦‚æœè·å¾—ä¸åˆ°ï¼Œä¼šé€šè¿‡è‡ªæ—‹ï¼›å½“è½»é‡çº§é”ç«äº‰å¤±è´¥æ—¶ï¼Œé”ä¼šå‡çº§ä¸ºé‡é‡çº§é”ã€‚æ­¤æ—¶ï¼ŒJVMä¼šä½¿ç”¨æ“ä½œç³»ç»Ÿçš„äº’æ–¥é‡ï¼ˆMutexï¼‰æ¥å®ç°é”çš„äº’æ–¥æ“ä½œã€‚é‡é‡çº§é”æ¶‰åŠåˆ°ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„åˆ‡æ¢ï¼Œå¼€é”€è¾ƒå¤§ã€‚</p><p><img src="https://s2.loli.net/2023/06/21/MG793bamDBesr1d.png" alt="image-20230611235859502.png"></p><h4 id="3-ã€è½»é‡çº§é”ä¸€å®šæ¯”é‡é‡çº§é”æ€§èƒ½é«˜å—ï¼Ÿ"><a href="#3-ã€è½»é‡çº§é”ä¸€å®šæ¯”é‡é‡çº§é”æ€§èƒ½é«˜å—ï¼Ÿ" class="headerlink" title="(3)ã€è½»é‡çº§é”ä¸€å®šæ¯”é‡é‡çº§é”æ€§èƒ½é«˜å—ï¼Ÿ"></a>(3)ã€è½»é‡çº§é”ä¸€å®šæ¯”é‡é‡çº§é”æ€§èƒ½é«˜å—ï¼Ÿ</h4><p>å½“çº¿ç¨‹è¶³å¤Ÿå¤šçš„æ—¶å€™ï¼Œå¦‚æœä½¿ç”¨è½»é‡çº§é”ï¼Œå¾ˆå¤šä¸ªçº¿ç¨‹ä¼šè‡ªæ—‹ï¼Œæ²¡æœ‰æˆåŠŸå°†ä¼šä¸€ç›´è‡ªæ—‹ï¼Œè¿™æ ·è¿˜ä¼šæ¶ˆè€—cpuï¼Œæ­¤æ—¶è¿˜ä¸å¦‚ç›´æ¥æ”¾åœ¨é˜Ÿåˆ—ä¸­ä½¿ç”¨é‡é‡çº§é”ã€‚æ€»çš„æ¥è¯´å¦‚æœç«äº‰ä¸æ¿€çƒˆï¼Œè½»é‡çº§é”å¯ä»¥æä¾›æ›´å¥½çš„æ€§èƒ½ã€‚è€Œåœ¨é«˜åº¦ç«äº‰çš„æƒ…å†µä¸‹ï¼Œé‡é‡çº§é”å¯èƒ½æ›´é€‚åˆï¼Œé¿å…äº†è‡ªæ—‹å’Œä¸æ–­é‡è¯•çš„å¼€é”€ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œéœ€è¦æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œè¯„ä¼°å’Œæµ‹è¯•ï¼Œé€‰æ‹©é€‚å½“çš„é”æœºåˆ¶ã€‚</p><h3 id="2ã€synchronizedé”å‡çº§çŠ¶æ€å˜åŒ–åŸç†"><a href="#2ã€synchronizedé”å‡çº§çŠ¶æ€å˜åŒ–åŸç†" class="headerlink" title="2ã€synchronizedé”å‡çº§çŠ¶æ€å˜åŒ–åŸç†"></a>2ã€synchronizedé”å‡çº§çŠ¶æ€å˜åŒ–åŸç†</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä»ä»£ç çš„å½¢å¼æ¥äº†è§£synchronizedé”çš„å‡çº§çŠ¶æ€å˜åŒ–ã€‚</p><p>å› ä¸ºä½¿ç”¨äº† javaå¯¹è±¡çš„å†…å­˜å¸ƒå±€ä»¥åŠä½¿ç”¨ClassLayoutæŸ¥çœ‹å¸ƒå±€,é¦–å…ˆéœ€è¦å¯¼å…¥ä¾èµ–, 0.13æ˜¯æ˜¾ç¤ºäºŒè¿›åˆ¶ï¼Œ0.17æœ€æ–°ç‰ˆæœ¬æ˜¯æ˜¾ç¤ºåå…­è¿›åˆ¶ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  javaå¯¹è±¡çš„å†…å­˜å¸ƒå±€ä»¥åŠä½¿ç”¨ClassLayoutæŸ¥çœ‹å¸ƒå±€  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.openjdk.jol<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jol-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨mainæ–¹æ³•ä¸­ï¼Œé€šè¿‡ClassLayoutæŸ¥çœ‹å¸ƒå±€ï¼Œè¿™é‡ŒUseråªæ˜¯å®šä¹‰çš„ä¸€ä¸ªå¯¹è±¡å®ä½“ï¼Œé‡Œé¢åŒ…å«idå’Œnameå±æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">userTemp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="comment">/*javaå¯¹è±¡çš„å†…å­˜å¸ƒå±€ä»¥åŠä½¿ç”¨ClassLayoutæŸ¥çœ‹å¸ƒå±€*/</span></span><br><span class="line">System.out.println(<span class="string">&quot;æ— çŠ¶æ€(001)ï¼š&quot;</span> + ClassLayout.parseInstance(userTemp).toPrintable());</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™æ®µä»£ç çš„è¾“å‡ºï¼Œå¯ä»¥å¯¹ç…§é”çš„çŠ¶æ€å›¾æ¥çœ‹ï¼Œè¿™äº›ä¿¡æ¯åŒ…å«å¯¹è±¡å¤´markï¼Œclassï¼Œè¿˜æœ‰å¯¹è±¡å±æ€§ï¼Œæœ€å4å­—èŠ‚æ˜¯å¯¹é½ä½ï¼Œå› ä¸ºä½æ•°æ˜¯8çš„æ•´æ•°å€ã€‚markç”±8ä¸ªå­—èŠ‚ï¼Œ64bitç»„æˆï¼Œä»¥ä¸‹æ˜¯åå…­è¿›åˆ¶ï¼Œæˆ‘ä»¬è½¬æ¢æˆäºŒè¿›åˆ¶ï¼š0â€¦..001å¯¹æ¯”é”çŠ¶æ€å›¾æ¥çœ‹æ˜¯æ— é”çŠ¶æ€ã€‚</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">æ— çŠ¶æ€(<span class="number">001</span>)ï¼šcn.lyd.test.service.user.dto.User <span class="keyword">object</span> internals:</span><br><span class="line">OFF  SZ               TYPE DESCRIPTION               VALUE</span><br><span class="line">  <span class="number">0</span>   <span class="number">8</span>                    (<span class="keyword">object</span> header: mark)     <span class="number">0</span>x<span class="number">0000000000000001</span> (non-biasable; age: <span class="number">0</span>)</span><br><span class="line">  <span class="number">8</span>   <span class="number">4</span>                    (<span class="keyword">object</span> header: <span class="keyword">class</span>)    <span class="number">0</span>xf<span class="number">800</span>c<span class="number">143</span></span><br><span class="line"> <span class="number">12</span>   <span class="number">4</span>                int User.id                   <span class="number">0</span></span><br><span class="line"> <span class="number">16</span>   <span class="number">4</span>   java.lang.String User.name                 null</span><br><span class="line"> <span class="number">20</span>   <span class="number">4</span>                    (<span class="keyword">object</span> alignment gap)    </span><br><span class="line">Instance size: <span class="number">24</span> bytes</span><br><span class="line">Space losses: <span class="number">0</span> bytes internal + <span class="number">4</span> bytes external = <span class="number">4</span> bytes total</span><br></pre></td></tr></table></figure><p>å…ˆç»™å‡ºå…¨éƒ¨ä»£ç ï¼Œåé¢é’ˆå¯¹ä»£ç è¿›è¡Œè§£æï¼Œé€šè¿‡è¿™æ®µä»£ç ï¼Œå°±èƒ½å¤Ÿæ¸…æ™°çœ‹è§é”æ˜¯å¦‚ä½•å‡çº§çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: synchronizedé”å‡çº§çŠ¶æ€å˜åŒ–</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2023/6/11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LockUpgrade</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123; <span class="comment">// ä¸»çº¿ç¨‹</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">userTemp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        <span class="comment">/*javaå¯¹è±¡çš„å†…å­˜å¸ƒå±€ä»¥åŠä½¿ç”¨ClassLayoutæŸ¥çœ‹å¸ƒå±€*/</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ— çŠ¶æ€(001)ï¼š&quot;</span> + ClassLayout.parseInstance(userTemp).toPrintable());</span><br><span class="line">        <span class="comment">// jvmé»˜è®¤å»¶è¿Ÿ4sè‡ªåŠ¨å¼€æœºåå‘é”ï¼Œå¯ä»¥é€šè¿‡-XX:BiasedLockingStartupDelay = 0 å–æ¶ˆå»¶è¿Ÿ</span></span><br><span class="line">        <span class="comment">// å¦‚æœä¸éœ€è¦åå‘é”ï¼Œä½¿ç”¨-XX:- UseBiasedLocking = false å…³é—­</span></span><br><span class="line">        <span class="comment">// -&gt; ä¸€å¼€å§‹æ˜¯ä¸ä¼šè‡ªåŠ¨ä½¿ç”¨åå‘é”çš„ï¼Œå¦‚æœä¸€å¼€å§‹å°±ä½¿ç”¨synchronizedé”ï¼Œå°±ä¼šç›´æ¥ä½¿ç”¨é‡é‡çº§é”ï¼Œjvmä¸­éœ€è¦å»¶è¿Ÿ4sæ‰èƒ½å¤Ÿå¼€å¯åå‘é”ã€‚æ‰€ä»¥è¿™é‡Œå»¶è¿Ÿäº†5s</span></span><br><span class="line">        Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        <span class="comment">// åå‘é”è®¤ä¸ºä¸€å¼€å§‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ¥è®¿é—®</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(); <span class="comment">// é‡æ–°newä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">        System.out.println(<span class="string">&quot;å¯ç”¨åå‘é”(101)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (user) &#123; <span class="comment">// åŠ ä¸Šåå‘é”</span></span><br><span class="line">                System.out.println(<span class="string">&quot;åå‘é”(101)(å¸¦çº¿ç¨‹ID)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// è™½ç„¶è¿™é‡Œä¼šé‡Šæ”¾åå‘é”ï¼Œä½†å®é™…ä¸Šä¸ä¼šä¸»åŠ¨é‡Šæ”¾ï¼Œå¤´éƒ¨ï¼ˆé«˜54ä½ï¼‰æ˜¯ä¸ä¼šåšä¿®æ”¹çš„ï¼Œè¿™äº›æ•°å€¼ä»£è¡¨å±äºå“ªä¸ªçº¿ç¨‹</span></span><br><span class="line">            <span class="comment">// åœ¨åå‘é”ä¸­ï¼Œé«˜54ä½æ¥æ ‡è¯†çº¿ç¨‹idï¼Œä¸»è¦æ˜¯å¦‚æœåŒä¸ªçº¿ç¨‹è¿‡æ¥çš„ï¼Œå°±ç›´æ¥èµ°è¿™ä¸ªåå‘é”</span></span><br><span class="line">            System.out.println(<span class="string">&quot;é‡Šæ”¾åå‘é”(101)(å¸¦çº¿ç¨‹ID)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123; <span class="comment">// å¤šä¸ªçº¿ç¨‹ç«äº‰ï¼Œå¯èƒ½å‡çº§ä¸ºè½»é‡çº§é”</span></span><br><span class="line">            <span class="keyword">synchronized</span> (user) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;è½»é‡çº§é”(00)(å¸¦çº¿ç¨‹ID)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;ç¡çœ 3ç§’é’Ÿ==========================================&quot;</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">&quot;è½»é‡çº§é”å‡çº§é‡é‡çº§é”(10)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        <span class="comment">// å¼€å¯æ–°çš„çº¿ç¨‹, ç¬¬ä¸€ä¸ªçº¿ç¨‹è¿˜åœ¨ç¡çœ ä¸­ï¼Œæ„å‘³ç€çº¿ç¨‹è¿˜æ²¡æœ‰ç»“æŸï¼Œæ­¤æ—¶ç¬¬äºŒä¸ªçº¿ç¨‹å°±æ‰§è¡Œäº†ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å¤šä¸ªçº¿ç¨‹çš„è®¿é—®ï¼Œè¿™æ˜¯å°±ä¼šå‡çº§ä½é‡é‡çº§é”</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (user) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;é‡é‡çº§é”(10)(å¸¦çº¿ç¨‹ID)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç è§£æï¼š</p><p>é¦–å…ˆæ˜¯æ— é”çš„çŠ¶æ€ï¼Œè¿™ä¸ªåœ¨å‰é¢å·²ç»ä»‹ç»äº†ï¼Œç°åœ¨å°±ä¸å†ç»§ç»­èµ˜è¿°ã€‚æˆ‘ä»¬è¦çŸ¥é“ï¼Œjvmé»˜è®¤æ˜¯å»¶è¿Ÿ4sæ‰è‡ªåŠ¨å¼€æœºåå‘é”ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>-XX:BiasedLockingStartupDelay = 0</code> å–æ¶ˆå»¶è¿Ÿã€‚</p><p>ä¸€å¼€å§‹æ˜¯ä¸ä¼šè‡ªåŠ¨ä½¿ç”¨åå‘é”çš„ï¼Œå¦‚æœä¸€å¼€å§‹å°±ä½¿ç”¨synchronizedé”ï¼Œå°±ä¼šç›´æ¥ä½¿ç”¨é‡é‡çº§é”ï¼Œjvmä¸­éœ€è¦å»¶è¿Ÿ4sæ‰èƒ½å¤Ÿå¼€å¯åå‘é”ã€‚æ‰€ä»¥è¿™é‡Œå»¶è¿Ÿäº†5sã€‚</p><p>é‡æ–°newä¸€ä¸ªå¯¹è±¡ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹å¯ç”¨äº†åå‘é”ï¼Œæ³¨æ„ï¼Œè¿™é‡Œè™½ç„¶è¿˜æ²¡æœ‰ä¸Šé”ï¼Œä½†æ˜¯é”çš„ä½¿ç”¨æ˜¯éœ€è¦å…ˆå¼€å¯é”çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(); <span class="comment">// é‡æ–°newä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">System.out.println(<span class="string">&quot;å¯ç”¨åå‘é”(101)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹æ§åˆ¶å°çš„è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°å¤´éƒ¨markä¿¡æ¯ï¼Œè½¬æ¢äºŒè¿›åˆ¶å°±æ˜¯000â€¦â€¦.0101ï¼Œè¿™å¯ä»¥çœ‹åˆ°åå‘é”å°±å·²ç»å¯ç”¨äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è§‚å¯Ÿåˆ°åå‘çº¿ç¨‹idçš„54bitéƒ½æ˜¯0ï¼Œæ˜¾ç„¶è¿™æ—¶å€™è¿˜æ²¡æœ‰ä¸Šé”ï¼Œåªæ˜¯å¼€å¯äº†åå‘é”è€Œå·²ã€‚</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">å¯ç”¨åå‘é”(<span class="number">101</span>)ï¼šcn.lyd.test.service.user.dto.User <span class="keyword">object</span> internals:</span><br><span class="line">OFF  SZ               TYPE DESCRIPTION               VALUE</span><br><span class="line">  <span class="number">0</span>   <span class="number">8</span>                    (<span class="keyword">object</span> header: mark)     <span class="number">0</span>x<span class="number">0000000000000005</span> (biasable; age: <span class="number">0</span>)</span><br><span class="line">  <span class="number">8</span>   <span class="number">4</span>                    (<span class="keyword">object</span> header: <span class="keyword">class</span>)    <span class="number">0</span>xf<span class="number">800</span>c<span class="number">143</span></span><br><span class="line"> <span class="number">12</span>   <span class="number">4</span>                int User.id                   <span class="number">0</span></span><br><span class="line"> <span class="number">16</span>   <span class="number">4</span>   java.lang.String User.name                 null</span><br><span class="line"> <span class="number">20</span>   <span class="number">4</span>                    (<span class="keyword">object</span> alignment gap)    </span><br><span class="line">Instance size: <span class="number">24</span> bytes</span><br><span class="line">Space losses: <span class="number">0</span> bytes internal + <span class="number">4</span> bytes external = <span class="number">4</span> bytes total</span><br></pre></td></tr></table></figure><p>é€šè¿‡forå¾ªç¯ï¼Œä¸»çº¿ç¨‹ä¸¤æ¬¡è®¿é—®userè¿™æŠŠé”ï¼Œæ­¤æ—¶å¯åŠ¨çš„æ˜¯åå‘é”ï¼Œè¿™é‡Œæ˜¯æºå¸¦äº†çº¿ç¨‹idï¼Œåœ¨åå‘é”ä¸­ï¼Œé«˜54ä½æ¥æ ‡è¯†çº¿ç¨‹idï¼Œä¸»è¦æ˜¯å¦‚æœåŒä¸ªçº¿ç¨‹è¿‡æ¥çš„ï¼Œå°±ç›´æ¥èµ°è¿™ä¸ªåå‘é”ã€‚è¾“å‡ºå®Œåé‡Šæ”¾åå‘é”ï¼Œå®é™…ä¸Šä¸ä¼šä¸»åŠ¨é‡Šæ”¾ï¼Œå¤´éƒ¨é«˜54ä½å¹¶æ²¡æœ‰åšä¿®æ”¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (user) &#123; <span class="comment">// åŠ ä¸Šåå‘é”</span></span><br><span class="line">        System.out.println(<span class="string">&quot;åå‘é”(101)(å¸¦çº¿ç¨‹ID)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è™½ç„¶è¿™é‡Œä¼šé‡Šæ”¾åå‘é”ï¼Œä½†å®é™…ä¸Šä¸ä¼šä¸»åŠ¨é‡Šæ”¾ï¼Œå¤´éƒ¨ï¼ˆé«˜54ä½ï¼‰æ˜¯ä¸ä¼šåšä¿®æ”¹çš„ï¼Œè¿™äº›æ•°å€¼ä»£è¡¨å±äºå“ªä¸ªçº¿ç¨‹</span></span><br><span class="line">    <span class="comment">// åœ¨åå‘é”ä¸­ï¼Œé«˜54ä½æ¥æ ‡è¯†çº¿ç¨‹idï¼Œä¸»è¦æ˜¯å¦‚æœåŒä¸ªçº¿ç¨‹è¿‡æ¥çš„ï¼Œå°±ç›´æ¥èµ°è¿™ä¸ªåå‘é”</span></span><br><span class="line">    System.out.println(<span class="string">&quot;é‡Šæ”¾åå‘é”(101)(å¸¦çº¿ç¨‹ID)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ˜¯ä¸»çº¿ç¨‹æ¥ä¸¤æ¬¡è®¿é—®ï¼Œçº¿ç¨‹idéƒ½æ˜¯ç›¸åŒçš„ï¼Œæ ¹æ®å¤´markçš„äºŒè¿›åˆ¶å¯ä»¥è§£å‡ºçº¿ç¨‹idï¼š000â€¦.001100111111010100è¿™æ˜¯å°†0x00000000033f5005è½¬æ¢æˆäºŒè¿›åˆ¶ï¼Œå–é«˜54ä½çš„æ¥ã€‚</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">åå‘é”(<span class="number">101</span>)(å¸¦çº¿ç¨‹ID)ï¼šcn.lyd.test.service.user.dto.User <span class="keyword">object</span> internals:</span><br><span class="line">OFF  SZ               TYPE DESCRIPTION               VALUE</span><br><span class="line">  <span class="number">0</span>   <span class="number">8</span>                    (<span class="keyword">object</span> header: mark)     <span class="number">0</span>x<span class="number">00000000033f</span><span class="number">5005</span> (biased: <span class="number">0</span>x<span class="number">000000000000</span>cfd<span class="number">4</span>; epoch: <span class="number">0</span>; age: <span class="number">0</span>)</span><br><span class="line">  <span class="number">8</span>   <span class="number">4</span>                    (<span class="keyword">object</span> header: <span class="keyword">class</span>)    <span class="number">0</span>xf<span class="number">800</span>c<span class="number">143</span></span><br><span class="line"> <span class="number">12</span>   <span class="number">4</span>                int User.id                   <span class="number">0</span></span><br><span class="line"> <span class="number">16</span>   <span class="number">4</span>   java.lang.String User.name                 null</span><br><span class="line"> <span class="number">20</span>   <span class="number">4</span>                    (<span class="keyword">object</span> alignment gap)    </span><br><span class="line">Instance size: <span class="number">24</span> bytes</span><br><span class="line">Space losses: <span class="number">0</span> bytes internal + <span class="number">4</span> bytes external = <span class="number">4</span> bytes total</span><br><span class="line"></span><br><span class="line">é‡Šæ”¾åå‘é”(<span class="number">101</span>)(å¸¦çº¿ç¨‹ID)ï¼šcn.lyd.test.service.user.dto.User <span class="keyword">object</span> internals:</span><br><span class="line">OFF  SZ               TYPE DESCRIPTION               VALUE</span><br><span class="line">  <span class="number">0</span>   <span class="number">8</span>                    (<span class="keyword">object</span> header: mark)     <span class="number">0</span>x<span class="number">00000000033f</span><span class="number">5005</span> (biased: <span class="number">0</span>x<span class="number">000000000000</span>cfd<span class="number">4</span>; epoch: <span class="number">0</span>; age: <span class="number">0</span>)</span><br><span class="line">  <span class="number">8</span>   <span class="number">4</span>                    (<span class="keyword">object</span> header: <span class="keyword">class</span>)    <span class="number">0</span>xf<span class="number">800</span>c<span class="number">143</span></span><br><span class="line"> <span class="number">12</span>   <span class="number">4</span>                int User.id                   <span class="number">0</span></span><br><span class="line"> <span class="number">16</span>   <span class="number">4</span>   java.lang.String User.name                 null</span><br><span class="line"> <span class="number">20</span>   <span class="number">4</span>                    (<span class="keyword">object</span> alignment gap)    </span><br><span class="line">Instance size: <span class="number">24</span> bytes</span><br><span class="line">Space losses: <span class="number">0</span> bytes internal + <span class="number">4</span> bytes external = <span class="number">4</span> bytes total</span><br><span class="line"></span><br><span class="line">åå‘é”(<span class="number">101</span>)(å¸¦çº¿ç¨‹ID)ï¼šcn.lyd.test.service.user.dto.User <span class="keyword">object</span> internals:</span><br><span class="line">OFF  SZ               TYPE DESCRIPTION               VALUE</span><br><span class="line">  <span class="number">0</span>   <span class="number">8</span>                    (<span class="keyword">object</span> header: mark)     <span class="number">0</span>x<span class="number">00000000033f</span><span class="number">5005</span> (biased: <span class="number">0</span>x<span class="number">000000000000</span>cfd<span class="number">4</span>; epoch: <span class="number">0</span>; age: <span class="number">0</span>)</span><br><span class="line">  <span class="number">8</span>   <span class="number">4</span>                    (<span class="keyword">object</span> header: <span class="keyword">class</span>)    <span class="number">0</span>xf<span class="number">800</span>c<span class="number">143</span></span><br><span class="line"> <span class="number">12</span>   <span class="number">4</span>                int User.id                   <span class="number">0</span></span><br><span class="line"> <span class="number">16</span>   <span class="number">4</span>   java.lang.String User.name                 null</span><br><span class="line"> <span class="number">20</span>   <span class="number">4</span>                    (<span class="keyword">object</span> alignment gap)    </span><br><span class="line">Instance size: <span class="number">24</span> bytes</span><br><span class="line">Space losses: <span class="number">0</span> bytes internal + <span class="number">4</span> bytes external = <span class="number">4</span> bytes total</span><br><span class="line"></span><br><span class="line">é‡Šæ”¾åå‘é”(<span class="number">101</span>)(å¸¦çº¿ç¨‹ID)ï¼šcn.lyd.test.service.user.dto.User <span class="keyword">object</span> internals:</span><br><span class="line">OFF  SZ               TYPE DESCRIPTION               VALUE</span><br><span class="line">  <span class="number">0</span>   <span class="number">8</span>                    (<span class="keyword">object</span> header: mark)     <span class="number">0</span>x<span class="number">00000000033f</span><span class="number">5005</span> (biased: <span class="number">0</span>x<span class="number">000000000000</span>cfd<span class="number">4</span>; epoch: <span class="number">0</span>; age: <span class="number">0</span>)</span><br><span class="line">  <span class="number">8</span>   <span class="number">4</span>                    (<span class="keyword">object</span> header: <span class="keyword">class</span>)    <span class="number">0</span>xf<span class="number">800</span>c<span class="number">143</span></span><br><span class="line"> <span class="number">12</span>   <span class="number">4</span>                int User.id                   <span class="number">0</span></span><br><span class="line"> <span class="number">16</span>   <span class="number">4</span>   java.lang.String User.name                 null</span><br><span class="line"> <span class="number">20</span>   <span class="number">4</span>                    (<span class="keyword">object</span> alignment gap)    </span><br><span class="line">Instance size: <span class="number">24</span> bytes</span><br><span class="line">Space losses: <span class="number">0</span> bytes internal + <span class="number">4</span> bytes external = <span class="number">4</span> bytes total</span><br></pre></td></tr></table></figure><p>åˆšåˆšè·‘çš„æ˜¯ä¸»çº¿ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œä½¿å¾—å¤šä¸ªçº¿ç¨‹ç«äº‰ï¼Œè¿™å°±å¯èƒ½å°†åå‘é”å‡çº§ä¸ºè½»é‡çº§é”ã€‚å½“çº¿ç¨‹è·å–åˆ°è½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹è¿›æ¥ä¼šæ‹¿ä¸åˆ°ï¼Œæ­¤æ—¶ä¼šè‡ªæ—‹ã€‚è¿™é‡Œæˆ‘ä»¬ç¡çœ 3sï¼Œæ¥æ¨¡æ‹Ÿçº¿ç¨‹ç´§æ¡é”ä¸æ”¾ï¼Œè¿™æ—¶å€™æˆ‘ä»¬åœ¨å¼€ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œè¿˜æ˜¯æ¥äº‰æŠ¢userè¿™æŠŠé”ï¼Œè¿™å°±å¯¼è‡´CASè‡ªæ—‹å¤±è´¥ï¼Œé”è†¨èƒ€å°±ä¼šå°†è½»é‡çº§é”å‡çº§ä¸ºé‡é‡çº§é”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123; <span class="comment">// å¤šä¸ªçº¿ç¨‹ç«äº‰ï¼Œå¯èƒ½å‡çº§ä¸ºè½»é‡çº§é”</span></span><br><span class="line">    <span class="keyword">synchronized</span> (user) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è½»é‡çº§é”(00)(å¸¦çº¿ç¨‹ID)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç¡çœ 3ç§’é’Ÿ==========================================&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;è½»é‡çº§é”å‡çº§é‡é‡çº§é”(10)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).start();</span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"><span class="comment">// å¼€å¯æ–°çš„çº¿ç¨‹, ç¬¬ä¸€ä¸ªçº¿ç¨‹è¿˜åœ¨ç¡çœ ä¸­ï¼Œæ„å‘³ç€çº¿ç¨‹è¿˜æ²¡æœ‰ç»“æŸï¼Œæ­¤æ—¶ç¬¬äºŒä¸ªçº¿ç¨‹å°±æ‰§è¡Œäº†ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å¤šä¸ªçº¿ç¨‹çš„è®¿é—®ï¼Œè¿™æ˜¯å°±ä¼šå‡çº§ä½é‡é‡çº§é”</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (user) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é‡é‡çº§é”(10)(å¸¦çº¿ç¨‹ID)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).start();</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸‹æ—¥å¿—ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¤´markè½¬æ¢æˆäºŒè¿›åˆ¶ï¼Œå–æœ€åä¸¤ä½é”æ ‡è®°ä½ï¼Œèƒ½å¤Ÿæ¸…æ™°çœ‹åˆ°è½»é‡çº§é”å‡çº§åˆ°é‡é‡çº§é”ã€‚</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">è½»é‡çº§é”(<span class="number">00</span>)(å¸¦çº¿ç¨‹ID)ï¼šcn.lyd.test.service.user.dto.User <span class="keyword">object</span> internals:</span><br><span class="line">OFF  SZ               TYPE DESCRIPTION               VALUE</span><br><span class="line">  <span class="number">0</span>   <span class="number">8</span>                    (<span class="keyword">object</span> header: mark)     <span class="number">0</span>x<span class="number">000000002</span>a<span class="number">11</span>ef<span class="number">08</span> (thin lock: <span class="number">0</span>x<span class="number">000000002</span>a<span class="number">11</span>ef<span class="number">08</span>)</span><br><span class="line">  <span class="number">8</span>   <span class="number">4</span>                    (<span class="keyword">object</span> header: <span class="keyword">class</span>)    <span class="number">0</span>xf<span class="number">800</span>c<span class="number">143</span></span><br><span class="line"> <span class="number">12</span>   <span class="number">4</span>                int User.id                   <span class="number">0</span></span><br><span class="line"> <span class="number">16</span>   <span class="number">4</span>   java.lang.String User.name                 null</span><br><span class="line"> <span class="number">20</span>   <span class="number">4</span>                    (<span class="keyword">object</span> alignment gap)    </span><br><span class="line">Instance size: <span class="number">24</span> bytes</span><br><span class="line">Space losses: <span class="number">0</span> bytes internal + <span class="number">4</span> bytes external = <span class="number">4</span> bytes total</span><br><span class="line"></span><br><span class="line">ç¡çœ <span class="number">3</span>ç§’é’Ÿ==========================================</span><br><span class="line">è½»é‡çº§é”å‡çº§é‡é‡çº§é”(<span class="number">10</span>)ï¼šcn.lyd.test.service.user.dto.User <span class="keyword">object</span> internals:</span><br><span class="line">OFF  SZ               TYPE DESCRIPTION               VALUE</span><br><span class="line">  <span class="number">0</span>   <span class="number">8</span>                    (<span class="keyword">object</span> header: mark)     <span class="number">0</span>x<span class="number">0000000024232f</span><span class="number">6</span>a (fat lock: <span class="number">0</span>x<span class="number">0000000024232f</span><span class="number">6</span>a)</span><br><span class="line">  <span class="number">8</span>   <span class="number">4</span>                    (<span class="keyword">object</span> header: <span class="keyword">class</span>)    <span class="number">0</span>xf<span class="number">800</span>c<span class="number">143</span></span><br><span class="line"> <span class="number">12</span>   <span class="number">4</span>                int User.id                   <span class="number">0</span></span><br><span class="line"> <span class="number">16</span>   <span class="number">4</span>   java.lang.String User.name                 null</span><br><span class="line"> <span class="number">20</span>   <span class="number">4</span>                    (<span class="keyword">object</span> alignment gap)    </span><br><span class="line">Instance size: <span class="number">24</span> bytes</span><br><span class="line">Space losses: <span class="number">0</span> bytes internal + <span class="number">4</span> bytes external = <span class="number">4</span> bytes total</span><br><span class="line">    </span><br><span class="line">é‡é‡çº§é”(<span class="number">10</span>)(å¸¦çº¿ç¨‹ID)ï¼šcn.lyd.test.service.user.dto.User <span class="keyword">object</span> internals:</span><br><span class="line">OFF  SZ               TYPE DESCRIPTION               VALUE</span><br><span class="line">  <span class="number">0</span>   <span class="number">8</span>                    (<span class="keyword">object</span> header: mark)     <span class="number">0</span>x<span class="number">0000000024232f</span><span class="number">6</span>a (fat lock: <span class="number">0</span>x<span class="number">0000000024232f</span><span class="number">6</span>a)</span><br><span class="line">  <span class="number">8</span>   <span class="number">4</span>                    (<span class="keyword">object</span> header: <span class="keyword">class</span>)    <span class="number">0</span>xf<span class="number">800</span>c<span class="number">143</span></span><br><span class="line"> <span class="number">12</span>   <span class="number">4</span>                int User.id                   <span class="number">0</span></span><br><span class="line"> <span class="number">16</span>   <span class="number">4</span>   java.lang.String User.name                 null</span><br><span class="line"> <span class="number">20</span>   <span class="number">4</span>                    (<span class="keyword">object</span> alignment gap)    </span><br><span class="line">Instance size: <span class="number">24</span> bytes</span><br><span class="line">Space losses: <span class="number">0</span> bytes internal + <span class="number">4</span> bytes external = <span class="number">4</span> bytes total</span><br></pre></td></tr></table></figure><h2 id="æ–‡ç« èµ„æ–™"><a href="#æ–‡ç« èµ„æ–™" class="headerlink" title="æ–‡ç« èµ„æ–™"></a>æ–‡ç« èµ„æ–™</h2><p><a href="https://zhuanlan.zhihu.com/p/160185717">https://zhuanlan.zhihu.com/p/160185717</a></p><p><a href="https://juejin.cn/post/6978882583492821023">https://juejin.cn/post/6978882583492821023</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ã€å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘ã€‘-é”çš„æœºåˆ¶ä¸åº•å±‚ä¼˜åŒ–åŸç†&quot;&gt;&lt;a href=&quot;#ã€å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘ã€‘-é”çš„æœºåˆ¶ä¸åº•å±‚ä¼˜åŒ–åŸç†&quot; class=&quot;headerlink&quot; title=&quot;ã€å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘ã€‘- é”çš„æœºåˆ¶ä¸åº•å±‚ä¼˜åŒ–åŸç†&quot;&gt;&lt;/a&gt;ã€å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘ã€‘- é”çš„æœºåˆ¶ä¸åº•å±‚ä¼˜åŒ–åŸç†</summary>
      
    
    
    
    
    <category term="å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘" scheme="https://lydandtry.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
</feed>
