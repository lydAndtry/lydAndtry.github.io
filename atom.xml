<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ€’æ”¾å§å¾·å¾·</title>
  
  <subtitle>ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº</subtitle>
  <link href="https://lydandtry.github.io/atom.xml" rel="self"/>
  
  <link href="https://lydandtry.github.io/"/>
  <updated>2023-06-27T04:12:01.443Z</updated>
  <id>https://lydandtry.github.io/</id>
  
  <author>
    <name>Liyongde</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Javaè®¾è®¡æ¨¡å¼-å·¥å‚æ¨¡å¼</title>
    <link href="https://lydandtry.github.io/posts/60745/"/>
    <id>https://lydandtry.github.io/posts/60745/</id>
    <published>2023-06-24T23:04:41.000Z</published>
    <updated>2023-06-27T04:12:01.443Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Javaè®¾è®¡æ¨¡å¼-å·¥å‚æ¨¡å¼"><a href="#Javaè®¾è®¡æ¨¡å¼-å·¥å‚æ¨¡å¼" class="headerlink" title="Javaè®¾è®¡æ¨¡å¼ -å·¥å‚æ¨¡å¼"></a>Javaè®¾è®¡æ¨¡å¼ -å·¥å‚æ¨¡å¼</h1><blockquote><p>ğŸ˜„ ä¸æ–­å­¦ä¹ æ‰æ˜¯ç‹é“<br>ğŸ”¥ ç»§ç»­è¸ä¸Šå­¦ä¹ ä¹‹è·¯ï¼Œå­¦ä¹‹åˆ†äº«ç¬”è®°<br>ğŸ‘Š æ€»æœ‰ä¸€å¤©æˆ‘ä¹Ÿèƒ½åƒå„ä½å¤§ä½¬ä¸€æ ·<br>ğŸ† ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº @æ€’æ”¾å§å¾·å¾·<br>ğŸŒåˆ†äº«å­¦ä¹ å¿ƒå¾—ï¼Œæ¬¢è¿æŒ‡æ­£ï¼Œå¤§å®¶ä¸€èµ·å­¦ä¹ æˆé•¿ï¼</p></blockquote><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>åœ¨å¤§å¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯ç”¨newå»å®ä¾‹åŒ–å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶å€™æœ‰çš„å¯¹è±¡çš„ç±»åˆ«æœ‰å¾ˆå¤šç§ï¼Œåˆå­˜åœ¨ç€å…±æ€§ï¼Œå°±å¥½æ¯”å¦‚æ±½è½¦ï¼Œæœ‰å¥”é©°ï¼Œçº¢æ——ï¼Œå®é©¬ç­‰å“ç‰Œï¼Œå¦‚æœæ˜¯ä¸€ä¸ªä¸€ä¸ªå»åˆ›å»ºç±»ï¼Œé‚£å°±éœ€è¦åˆ›å»ºå¾ˆå¤šï¼Œå› æ­¤å°±éœ€è¦ç”¨åˆ°å·¥å‚æ¨¡å¼ã€‚</p><h2 id="1ã€æ™®é€šå·¥å‚-Simple-Factory-æ¨¡å¼"><a href="#1ã€æ™®é€šå·¥å‚-Simple-Factory-æ¨¡å¼" class="headerlink" title="1ã€æ™®é€šå·¥å‚(Simple Factory)æ¨¡å¼"></a>1ã€æ™®é€šå·¥å‚(Simple Factory)æ¨¡å¼</h2><p>åœ¨ç®€å•å·¥å‚æ¨¡å¼ä¸­ï¼Œå¯ä»¥æ ¹æ®å‚æ•°çš„ä¸åŒè¿”å›ä¸åŒç±»çš„å®ä¾‹ã€‚ç®€å•å·¥å‚æ¨¡å¼ä¸“é—¨å®šä¹‰ä¸€ä¸ªç±»æ¥è´Ÿè´£åˆ›å»ºå…¶ä»–ç±»çš„å®ä¾‹ï¼Œè¢«åˆ›å»ºçš„å®ä¾‹é€šå¸¸éƒ½å…·æœ‰å…±åŒçš„çˆ¶ç±»ã€‚<br>UMLå¦‚å›¾ï¼š<br><img src="https://img1.imgtp.com/2023/06/24/9lYQUxph.jpg" alt="ç®€å•å·¥å‚æ¨¡å¼.jpg"></p><h3 id="â‘ ã€å®šä¹‰ç±»"><a href="#â‘ ã€å®šä¹‰ç±»" class="headerlink" title="â‘ ã€å®šä¹‰ç±»"></a>â‘ ã€å®šä¹‰ç±»</h3><p>é¦–å…ˆå®šä¹‰ä¸€ä¸ªæ±½è½¦æŠ½è±¡ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.entity;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: äº§å“å®ä½“</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ICar</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ICar</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">contract</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pickUp</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æè½¦-&gt;&quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰å¥”é©°æ±½è½¦ç±»å’Œçº¢æ——æ±½è½¦ç±»ã€‚å¹¶ä¸”ç»§æ‰¿åŸºç±»<br>å¥”é©°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.entity;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: å¥”é©°æ±½è½¦ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BenzCar</span> <span class="keyword">extends</span> <span class="title class_">ICar</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BenzCar</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contract</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¥”é©°æ——èˆ°åº—å’Œå®¢æˆ·ç­¾è®¢åˆåŒ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>çº¢æ——ç±»ä¸å¥”é©°ç±»ä¼¼ï¼Œè¿™é‡Œå°±ä¸è´´å†—ä½™ä»£ç äº†</p><h3 id="â‘¡ã€å®šä¹‰ç®€å•çš„å·¥å‚ç±»"><a href="#â‘¡ã€å®šä¹‰ç®€å•çš„å·¥å‚ç±»" class="headerlink" title="â‘¡ã€å®šä¹‰ç®€å•çš„å·¥å‚ç±»"></a>â‘¡ã€å®šä¹‰ç®€å•çš„å·¥å‚ç±»</h3><p>å·¥å‚ç±»ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.simpleFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.entity.BenzCar;</span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.entity.HongQiCar;</span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.entity.ICar;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.NotContextException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ™®é€šå·¥å‚æ¨¡å¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ICar <span class="title function_">createCar</span><span class="params">(String carId)</span> <span class="keyword">throws</span> NotContextException &#123;</span><br><span class="line">        <span class="keyword">switch</span> (carId) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;1&quot;</span>: <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BenzCar</span>(<span class="string">&quot;å¥”é©°GLA&quot;</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;2&quot;</span>: <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HongQiCar</span>(<span class="string">&quot;çº¢æ——H7&quot;</span>);</span><br><span class="line">            <span class="keyword">default</span>: <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NotContextException</span>(<span class="string">&quot;æ²¡æœ‰è¯¥ç¼–å·çš„æ±½è½¦&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â‘¢ã€å®ä¾‹"><a href="#â‘¢ã€å®ä¾‹" class="headerlink" title="â‘¢ã€å®ä¾‹"></a>â‘¢ã€å®ä¾‹</h3><p>æµ‹è¯•å®éªŒ</p><blockquote><p>å¯¹è°ƒç”¨è€…æ¥è¯´ï¼Œå°±åªéœ€è¦çŸ¥é“createCaræ–¹æ³•ï¼ŒæŒ‡å®šæ±½è½¦çš„ç¼–å·å°±å¯ä»¥å®ä¾‹åŒ–å‡ºå¯¹åº”çš„å¯¹è±¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.entity.ICar;</span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.simpleFactory.CarFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.NotContextException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æµ‹è¯•ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleFactoryTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NotContextException &#123;</span><br><span class="line">        <span class="type">ICar</span> <span class="variable">car</span> <span class="operator">=</span> CarFactory.createCar(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        car.contract();</span><br><span class="line">        car.pickUp();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ:<br><img src="https://img1.imgtp.com/2023/06/24/SJmKfwrv.png" alt="æˆªå›¾.png"></p><h2 id="2ã€æŠ½è±¡å·¥å‚-Abstract-Factory-æ¨¡å¼"><a href="#2ã€æŠ½è±¡å·¥å‚-Abstract-Factory-æ¨¡å¼" class="headerlink" title="2ã€æŠ½è±¡å·¥å‚(Abstract Factory)æ¨¡å¼"></a>2ã€æŠ½è±¡å·¥å‚(Abstract Factory)æ¨¡å¼</h2><p>æŠ½è±¡å·¥å‚æ¨¡å¼æä¾›ä¸€ä¸ªæ¥å£ï¼Œä¸å¿…å»æŒ‡å®šå…·ä½“çš„äº§å“ï¼Œåˆ›å»ºå¤šä¸ªäº§å“æ—çš„äº§å“å¯¹è±¡ã€‚å¯¹äºæ™®é€šçš„å·¥å‚æ¥è¯´ï¼Œå¯ä»¥è§£å†³ä¸€ç±»å¯¹è±¡çš„åˆ›å»ºï¼Œä½†æ˜¯å¯¹è±¡æœ‰æ—¶å€™å¾ˆå¤æ‚ï¼Œåœ¨æœ‰å‡ åç§å¯¹è±¡ä¸­åˆåˆ†äº†å¥½å‡ ç§ç±»å‹ï¼Œåªæœ‰ä¸€ä¸ªå·¥å‚çš„è¯ï¼Œå®ç°èµ·æ¥å°±ååˆ†å¤æ‚ï¼Œå› æ­¤éœ€è¦å§å·¥å‚åˆ†ä¸ºå¾ˆå¤šç§ï¼Œå°±æ¯”å¦‚æ±½è½¦ä¸­æœ‰å¥”é©°ã€çº¢æ——ç­‰ï¼Œåœ¨å¥”é©°ä¸­åˆåˆ†ä¸ºäº†Açº§Cçº§ç­‰ï¼Œè¿™å°±å¯ä»¥å§å¥”é©°ï¼Œçº¢æ——åˆ›å»ºå„è‡ªçš„å·¥å‚ï¼Œç”±å·¥å‚æ¥åˆ’åˆ†æ˜¯å…·ä½“å“ªä¸ªå¯¹è±¡ã€‚<br>UMLå¦‚å›¾ï¼š<br><img src="https://img1.imgtp.com/2023/06/24/utlVF1g1.jpg" alt="æŠ½è±¡å·¥å‚æ¨¡å¼.jpg"></p><h3 id="â‘ ã€å®šä¹‰ç±»-1"><a href="#â‘ ã€å®šä¹‰ç±»-1" class="headerlink" title="â‘ ã€å®šä¹‰ç±»"></a>â‘ ã€å®šä¹‰ç±»</h3><p>é‡‡ç”¨ä»¥ä¸Šçš„IcaræŠ½è±¡ç±»ï¼Œæœ¬æ¬¡å®šä¹‰äº†å››ä¸ªç±»ï¼šBenzGLAã€BenzGLBã€HongQiH5ã€HongQiH7</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.car.entity.benz;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.car.entity.ICar;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: å¥”é©°GLA</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BenzGLA</span> <span class="keyword">extends</span> <span class="title class_">ICar</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BenzGLA</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contract</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¥”é©°æ——èˆ°åº—å’Œå®¢æˆ·ç­¾è®¢åˆåŒ-è´­ä¹°-&gt;&quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å…¶ä»–ç±»éƒ½ä¸€æ ·ï¼Œå°±ä¸ä¸€ä¸ªä¸€ä¸ªç²˜è´´</p><h3 id="â‘¡ã€å®šä¹‰å·¥å‚æ¥å£"><a href="#â‘¡ã€å®šä¹‰å·¥å‚æ¥å£" class="headerlink" title="â‘¡ã€å®šä¹‰å·¥å‚æ¥å£"></a>â‘¡ã€å®šä¹‰å·¥å‚æ¥å£</h3><p>ICarFactory:<br>åªæä¾›ä¸€ä¸ªåˆ›å»ºäº§å“çš„æ¥å£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.car.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.car.entity.ICar;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ±½è½¦å·¥å‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ICarFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ICar <span class="title function_">createProduct</span><span class="params">(String CarNo)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰å¥”é©°å’Œçº¢æ——çš„å·¥å‚ç±»</p><blockquote><p>ä¸¤ä¸ªå·¥å‚ç±»ä¹Ÿéƒ½æ˜¯å·®ä¸å¤šï¼Œéœ€è¦å®ç°ICarFactoryï¼Œå¹¶ä¸”å®ç°å…·ä½“æ–¹æ³•ï¼Œåœ¨æ­¤æ–¹æ³•æ¥æ ¹æ®éœ€è¦ç”Ÿæˆå¯¹åº”çš„å¯¹è±¡ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.car.factory.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.car.entity.ICar;</span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.car.entity.benz.BenzGLA;</span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.car.entity.benz.BenzGLB;</span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.car.factory.ICarFactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: å¥”é©°æ±½è½¦çš„å·¥å‚ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BenzFactory</span> <span class="keyword">implements</span> <span class="title class_">ICarFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ICar <span class="title function_">createProduct</span><span class="params">(String CarNo)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¥”é©°å·¥å‚&quot;</span>);</span><br><span class="line">        <span class="type">ICar</span> <span class="variable">car</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// æ ¹æ®idåˆ›å»ºäº§å“</span></span><br><span class="line">        <span class="keyword">if</span> (CarNo.equals(<span class="string">&quot;GLA&quot;</span>)) &#123;</span><br><span class="line">            <span class="comment">// ç”ŸæˆGLAå‹å·çš„å¥”é©°æ±½è½¦</span></span><br><span class="line">            car = <span class="keyword">new</span> <span class="title class_">BenzGLA</span>(CarNo);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (CarNo.equals(<span class="string">&quot;GLB&quot;</span>)) &#123;</span><br><span class="line">            <span class="comment">// ç”ŸæˆGLBå‹å·çš„å¥”é©°æ±½è½¦</span></span><br><span class="line">            car = <span class="keyword">new</span> <span class="title class_">BenzGLB</span>(CarNo);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (car != <span class="literal">null</span>) <span class="keyword">return</span> car;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>çº¢æ——çš„å·¥å‚ç±»åŒ</p></blockquote><p>æ±½è½¦å·¥å‚ç±»ï¼š</p><blockquote><p>æ ¹æ®ä¸€å®šçš„é€»è¾‘ï¼ˆæœ¬æ¬¡å®éªŒæ ¹æ®ç¼–å·ï¼‰æ¥ç”Ÿæˆå¯¹åº”çš„å·¥å‚ï¼Œåœ¨ç”±å·¥å‚å»åˆ¤æ–­å®ä¾‹åŒ–å“ªä¸ªå¯¹è±¡ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.car.factory.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.car.entity.ICar;</span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.car.factory.ICarFactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ±½è½¦å·¥å‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarFactory</span> <span class="keyword">implements</span> <span class="title class_">ICarFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ICar <span class="title function_">createProduct</span><span class="params">(String CarNo)</span> &#123;</span><br><span class="line">        <span class="type">ICarFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (CarNo.equals(<span class="string">&quot;GLA&quot;</span>) || CarNo.equals(<span class="string">&quot;GLB&quot;</span>)) &#123; <span class="comment">// å¦‚æœæ˜¯å¥”é©°çš„å“ç‰Œ</span></span><br><span class="line">            factory = <span class="keyword">new</span> <span class="title class_">BenzFactory</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            factory = <span class="keyword">new</span> <span class="title class_">HongQiFactory</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (factory != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> factory.createProduct(CarNo);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â‘¢ã€å®ä¾‹-1"><a href="#â‘¢ã€å®ä¾‹-1" class="headerlink" title="â‘¢ã€å®ä¾‹"></a>â‘¢ã€å®ä¾‹</h3><p>æµ‹è¯•æŠ½è±¡å·¥å‚æ¨¡å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.car.entity.ICar;</span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.car.factory.impl.CarFactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æµ‹è¯•ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CarFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CarFactory</span>();</span><br><span class="line">        <span class="type">ICar</span> <span class="variable">car</span> <span class="operator">=</span> factory.createProduct(<span class="string">&quot;GLA&quot;</span>);</span><br><span class="line">        car.contract();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ:<br><img src="https://img1.imgtp.com/2023/06/24/4ibWlCyn.png" alt="æˆªå›¾"></p>]]></content>
    
    
    <summary type="html">åœ¨å¤§å¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯ç”¨newå»å®ä¾‹åŒ–å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶å€™æœ‰çš„å¯¹è±¡çš„ç±»åˆ«æœ‰å¾ˆå¤šç§ï¼Œåˆå­˜åœ¨ç€å…±æ€§ï¼Œå°±å¥½æ¯”å¦‚æ±½è½¦ï¼Œæœ‰å¥”é©°ï¼Œçº¢æ——ï¼Œå®é©¬ç­‰å“ç‰Œï¼Œå¦‚æœæ˜¯ä¸€ä¸ªä¸€ä¸ªå»åˆ›å»ºç±»ï¼Œé‚£å°±éœ€è¦åˆ›å»ºå¾ˆå¤šï¼Œå› æ­¤å°±éœ€è¦ç”¨åˆ°å·¥å‚æ¨¡å¼ã€‚</summary>
    
    
    
    <category term="Javaè®¾è®¡æ¨¡å¼" scheme="https://lydandtry.github.io/categories/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://lydandtry.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="Java" scheme="https://lydandtry.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Javaè®¾è®¡æ¨¡å¼-è´£ä»»é“¾æ¨¡å¼</title>
    <link href="https://lydandtry.github.io/posts/33900/"/>
    <id>https://lydandtry.github.io/posts/33900/</id>
    <published>2023-06-24T22:39:25.000Z</published>
    <updated>2023-06-27T04:12:01.443Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Javaè®¾è®¡æ¨¡å¼-è´£ä»»é“¾æ¨¡å¼"><a href="#Javaè®¾è®¡æ¨¡å¼-è´£ä»»é“¾æ¨¡å¼" class="headerlink" title="Javaè®¾è®¡æ¨¡å¼ - è´£ä»»é“¾æ¨¡å¼"></a>Javaè®¾è®¡æ¨¡å¼ - è´£ä»»é“¾æ¨¡å¼</h1><blockquote><p>ğŸ˜„ ä¸æ–­å­¦ä¹ æ‰æ˜¯ç‹é“<br>ğŸ”¥ ç»§ç»­è¸ä¸Šå­¦ä¹ ä¹‹è·¯ï¼Œå­¦ä¹‹åˆ†äº«ç¬”è®°<br>ğŸ‘Š æ€»æœ‰ä¸€å¤©æˆ‘ä¹Ÿèƒ½åƒå„ä½å¤§ä½¬ä¸€æ ·<br>ğŸ† ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº @æ€’æ”¾å§å¾·å¾·</p></blockquote><h2 id="æ‹¦æˆªå™¨"><a href="#æ‹¦æˆªå™¨" class="headerlink" title="æ‹¦æˆªå™¨"></a>æ‹¦æˆªå™¨</h2><p>æ‹¦æˆªå™¨å¯ä»¥æ‹¦æˆªç›®æ ‡æ–¹æ³•ï¼Œè¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œã€‚ä¹Ÿå¯ä»¥å–ä»£ä»£ç†å¯¹è±¡çš„æ–¹æ³•ç­‰åŠŸèƒ½ã€‚ä»¥ä¸‹ä»£ç ç”¨JDKåŠ¨æ€ä»£ç†æ¥å®ç°ä¸€ä¸ªæ‹¦æˆªå™¨çš„é€»è¾‘ã€‚</p><h3 id="1ã€æ¥å£æä¾›"><a href="#1ã€æ¥å£æä¾›" class="headerlink" title="1ã€æ¥å£æä¾›"></a>1ã€æ¥å£æä¾›</h3><p>é¦–å…ˆæä¾›æ–¹æ³•æ¥å£å’Œå®ç°ç±»ä½œä¸ºåŠ¨æ€ä»£ç†æ‹¦æˆªçš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ™®é€šçš„æ¥å£</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HelloWorldService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHelloWorld</span><span class="params">(String name)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.service.HelloWorldService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ¥å£å®ç°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">HelloWorldService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHelloWorld</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello World! &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2ã€å®šä¹‰æ‹¦æˆªå™¨æ¥å£Interceptor"><a href="#2ã€å®šä¹‰æ‹¦æˆªå™¨æ¥å£Interceptor" class="headerlink" title="2ã€å®šä¹‰æ‹¦æˆªå™¨æ¥å£Interceptor"></a>2ã€å®šä¹‰æ‹¦æˆªå™¨æ¥å£Interceptor</h3><p>è¿™é‡Œå®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•ï¼š<strong>beforeã€aroundã€after</strong>ï¼Œéƒ½æœ‰ï¼šä»£ç†å¯¹è±¡ <strong>proxy</strong>, çœŸå®å¯¹è±¡ <strong>target</strong>, æ–¹æ³• <strong>method</strong>, å‚æ•° <strong>args</strong></p><ul><li>beforeæ–¹æ³•è¿”å›çš„æ˜¯Booleanï¼Œåœ¨çœŸå®å¯¹è±¡å‰è°ƒç”¨ã€‚</li><li>è¿”å›trueæ—¶ï¼Œåå°„çœŸå®å¯¹è±¡çš„æ–¹æ³•ï¼Œfalseæ—¶ï¼Œè°ƒç”¨aroundæ–¹æ³•<br>æœ€åæ‰§è¡Œafteræ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ‹¦æˆªå™¨æ¥å£</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">before</span><span class="params">(Object proxy, Object target, Method method, Object[] args)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">around</span><span class="params">(Object proxy, Object target, Method method, Object[] args)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">(Object proxy, Object target, Method method, Object[] args)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€å®šä¹‰æ‹¦æˆªå™¨å®ç°ç±»"><a href="#3ã€å®šä¹‰æ‹¦æˆªå™¨å®ç°ç±»" class="headerlink" title="3ã€å®šä¹‰æ‹¦æˆªå™¨å®ç°ç±»"></a>3ã€å®šä¹‰æ‹¦æˆªå™¨å®ç°ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.interceptor.Interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: å®ç°æ‹¦æˆªæ¥å£</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">before</span><span class="params">(Object proxy, Object target, Method method, Object[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åå°„æ–¹æ³•å‰é€»è¾‘&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// ä¸åå°„è¢«ä»£ç†å¯¹è±¡åŸæœ‰æ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">around</span><span class="params">(Object proxy, Object target, Method method, Object[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å–ä»£äº†ä»£ç†å¯¹è±¡çš„æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">(Object proxy, Object target, Method method, Object[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åå°„æ–¹æ³•åé€»è¾‘&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€é‡‡ç”¨JDKåŠ¨æ€ä»£ç†çš„æ–¹å¼ä½¿ç”¨æ‹¦æˆªå™¨"><a href="#4ã€é‡‡ç”¨JDKåŠ¨æ€ä»£ç†çš„æ–¹å¼ä½¿ç”¨æ‹¦æˆªå™¨" class="headerlink" title="4ã€é‡‡ç”¨JDKåŠ¨æ€ä»£ç†çš„æ–¹å¼ä½¿ç”¨æ‹¦æˆªå™¨"></a>4ã€é‡‡ç”¨JDKåŠ¨æ€ä»£ç†çš„æ–¹å¼ä½¿ç”¨æ‹¦æˆªå™¨</h3><p>æ„å»ºjdkä»£ç†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.jdk;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.interceptor.Interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: JDKåŠ¨æ€ä»£ç†ä½¿ç”¨æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InterceptorJdkProxy</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object target; <span class="comment">// çœŸå®å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">interceptorClass</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">// æ‹¦æˆªå™¨å…¨é™å®šå</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">InterceptorJdkProxy</span><span class="params">(Object target, String interceptorClass)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">        <span class="built_in">this</span>.interceptorClass = interceptorClass;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»‘å®šå§”æ‰˜å¯¹è±¡å¹¶è¿”å›ä¸€ä¸ªã€ä»£ç†å ä½ã€‘</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> target çœŸå®å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">bind</span><span class="params">(Object target, String interceptorClass)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(target.getClass().getClassLoader(),</span><br><span class="line">                target.getClass().getInterfaces(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InterceptorJdkProxy</span>(target, interceptorClass));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="keyword">if</span> (interceptorClass == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// æ²¡æœ‰è®¾ç½®æ‹¦æˆªå™¨åˆ™ç›´æ¥åå°„åŸæœ‰æ–¹æ³•</span></span><br><span class="line">            <span class="keyword">return</span> method.invoke(proxy, args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// é€šè¿‡åå°„ç”Ÿæˆæ‹¦æˆªå™¨</span></span><br><span class="line">        <span class="type">Interceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> (Interceptor) Class.forName(interceptorClass).newInstance();</span><br><span class="line">        <span class="comment">// è°ƒç”¨å‰ç½®æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> (interceptor.before(proxy, target, method, args)) &#123;</span><br><span class="line">            <span class="comment">//åå°„åŸæœ‰æ–¹æ³•</span></span><br><span class="line">            <span class="keyword">return</span> method.invoke(target, args);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// è¿”å›falseæ–¹æ³•æ‰§è¡Œaroundæ–¹æ³•</span></span><br><span class="line">            interceptor.around(proxy, target, method, args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è°ƒç”¨åç½®æ–¹æ³•</span></span><br><span class="line">        interceptor.after(proxy, target, method, args);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€å®ä¾‹"><a href="#5ã€å®ä¾‹" class="headerlink" title="5ã€å®ä¾‹"></a>5ã€å®ä¾‹</h3><p>æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.jdk.InterceptorJdkProxy;</span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.service.HelloWorldService;</span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.service.impl.HelloWorldServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æµ‹è¯•ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InterceptorTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">HelloWorldService</span> <span class="variable">proxy</span> <span class="operator">=</span> (HelloWorldService) InterceptorJdkProxy.bind(<span class="keyword">new</span> <span class="title class_">HelloWorldServiceImpl</span>(), <span class="string">&quot;com.lyd.demo.impl.MyInterceptor&quot;</span>);</span><br><span class="line">        proxy.sayHelloWorld(<span class="string">&quot;lyd&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç»“æœï¼š<br><img src="https://img1.imgtp.com/2023/06/24/68dCQLuz.png" alt="ç»“æœ1"></p><h2 id="è´£ä»»é“¾æ¨¡å¼"><a href="#è´£ä»»é“¾æ¨¡å¼" class="headerlink" title="è´£ä»»é“¾æ¨¡å¼"></a>è´£ä»»é“¾æ¨¡å¼</h2><p>å½“ä¸€ä¸ªå¯¹è±¡åœ¨ä¸€æ¡é“¾ä¸Šè¢«å¤šä¸ªæ‹¦æˆªå™¨æ‹¦æˆªå¤„ç†ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸æ‹¦æˆªå¤„ç†ï¼Œè¿™ç§çš„è®¾è®¡æ¨¡å¼å°±æ˜¯è´£ä»»é“¾æ¨¡å¼ã€‚å¯ä»¥åœ¨è¿™è¢«æ‹¦æˆªçš„æœŸé—´è¿›è¡ŒåŠ å·¥å¤„ç†ã€‚å°±å¥½æ¯”å¦‚ï¼Œæˆ‘ä»¬ç”³è¯·è¯·å‡ï¼Œéœ€è¦ç»è¿‡é¡¹ç›®ç»ç†ï¼Œå†åˆ°éƒ¨é—¨ç»ç†ï¼Œæœ€ååˆ°äººäº‹ã€‚åœ¨è¿™æœŸé—´ï¼Œç»ç†å®¡æ‰¹æ—¶å€™å¯ä»¥ä¿®æ”¹è¯·å‡å¤©æ•°ã€‚æœ¬æ¬¡å®éªŒç”¨ä»¥ä¸Šéƒ¨åˆ†ä»£ç ã€‚</p><h3 id="1ã€å®šä¹‰æ‹¦æˆªå™¨"><a href="#1ã€å®šä¹‰æ‹¦æˆªå™¨" class="headerlink" title="1ã€å®šä¹‰æ‹¦æˆªå™¨"></a>1ã€å®šä¹‰æ‹¦æˆªå™¨</h3><p>è¿™é‡Œå®šä¹‰ä¸‰ä¸ªæ‹¦æˆªå™¨åˆ†åˆ«æ˜¯ä¸‰ä¸ªç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.interceptor.Interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: è´£ä»»é“¾ - æ‹¦æˆªå™¨1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Interceptor1</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">before</span><span class="params">(Object proxy, Object target, Method method, Object[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‹¦æˆªå™¨1çš„before&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">around</span><span class="params">(Object proxy, Object target, Method method, Object[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">(Object proxy, Object target, Method method, Object[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‹¦æˆªå™¨1çš„after&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‹¦æˆªå™¨2,3ä¹Ÿæ˜¯å¦‚æ­¤å°±ä¸ç²˜è´´ä»£ç äº†ã€‚</p><h3 id="2ã€è´£ä»»é“¾ä¸Šä½¿ç”¨æ‹¦æˆªå™¨å®ä¾‹"><a href="#2ã€è´£ä»»é“¾ä¸Šä½¿ç”¨æ‹¦æˆªå™¨å®ä¾‹" class="headerlink" title="2ã€è´£ä»»é“¾ä¸Šä½¿ç”¨æ‹¦æˆªå™¨å®ä¾‹"></a>2ã€è´£ä»»é“¾ä¸Šä½¿ç”¨æ‹¦æˆªå™¨å®ä¾‹</h3><p>æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.jdk.InterceptorJdkProxy;</span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.service.HelloWorldService;</span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.service.impl.HelloWorldServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: è´£ä»»é“¾æ¨¡å¼æµ‹è¯•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponsibilityChainTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">HelloWorldService</span> <span class="variable">proxy1</span> <span class="operator">=</span> (HelloWorldService) InterceptorJdkProxy.bind(<span class="keyword">new</span> <span class="title class_">HelloWorldServiceImpl</span>(), <span class="string">&quot;com.lyd.demo.impl.Interceptor1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">HelloWorldService</span> <span class="variable">proxy2</span> <span class="operator">=</span> (HelloWorldService) InterceptorJdkProxy.bind(proxy1, <span class="string">&quot;com.lyd.demo.impl.Interceptor2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">HelloWorldService</span> <span class="variable">proxy3</span> <span class="operator">=</span> (HelloWorldService) InterceptorJdkProxy.bind(proxy2, <span class="string">&quot;com.lyd.demo.impl.Interceptor3&quot;</span>);</span><br><span class="line"></span><br><span class="line">        proxy3.sayHelloWorld(<span class="string">&quot;æ€’æ”¾å§å¾·å¾·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š<br><img src="https://img1.imgtp.com/2023/06/24/KOGXMFqs.png" alt="ç»“æœ2"></p>]]></content>
    
    
    <summary type="html">æ‹¦æˆªå™¨å¯ä»¥æ‹¦æˆªç›®æ ‡æ–¹æ³•ï¼Œè¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œã€‚ä¹Ÿå¯ä»¥å–ä»£ä»£ç†å¯¹è±¡çš„æ–¹æ³•ç­‰åŠŸèƒ½ã€‚ä»¥ä¸‹ä»£ç ç”¨JDKåŠ¨æ€ä»£ç†æ¥å®ç°ä¸€ä¸ªæ‹¦æˆªå™¨çš„é€»è¾‘ã€‚</summary>
    
    
    
    <category term="Javaè®¾è®¡æ¨¡å¼" scheme="https://lydandtry.github.io/categories/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://lydandtry.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="Java" scheme="https://lydandtry.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Javaè®¾è®¡æ¨¡å¼-åŠ¨æ€ä»£ç†</title>
    <link href="https://lydandtry.github.io/posts/27007/"/>
    <id>https://lydandtry.github.io/posts/27007/</id>
    <published>2023-06-24T21:58:34.000Z</published>
    <updated>2023-06-27T04:12:01.443Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ã€è®¾è®¡æ¨¡å¼ã€‘Javaè®¾è®¡æ¨¡å¼-åŠ¨æ€ä»£ç†"><a href="#ã€è®¾è®¡æ¨¡å¼ã€‘Javaè®¾è®¡æ¨¡å¼-åŠ¨æ€ä»£ç†" class="headerlink" title="ã€è®¾è®¡æ¨¡å¼ã€‘Javaè®¾è®¡æ¨¡å¼ - åŠ¨æ€ä»£ç†"></a>ã€è®¾è®¡æ¨¡å¼ã€‘Javaè®¾è®¡æ¨¡å¼ - åŠ¨æ€ä»£ç†</h1><blockquote><p>ğŸ˜„ ä¸æ–­å­¦ä¹ æ‰æ˜¯ç‹é“<br>ğŸ”¥ ç»§ç»­è¸ä¸Šå­¦ä¹ ä¹‹è·¯ï¼Œå­¦ä¹‹åˆ†äº«ç¬”è®°<br>ğŸ‘Š æ€»æœ‰ä¸€å¤©æˆ‘ä¹Ÿèƒ½åƒå„ä½å¤§ä½¬ä¸€æ ·<br>ğŸ† ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº @æ€’æ”¾å§å¾·å¾·<br>ğŸŒæœ€è¿‘å·¥ä½œæ¯”è¾ƒå¿™ï¼Œæ²¡å•¥æ—¶é—´å­¦ä¹ </p></blockquote><h2 id="1ã€ç®€ä»‹"><a href="#1ã€ç®€ä»‹" class="headerlink" title="1ã€ç®€ä»‹"></a>1ã€ç®€ä»‹</h2><p>åŠ¨æ€ä»£ç†æ˜¯æŒ‡å®¢æˆ·é€šè¿‡ä»£ç†ç±»æ¥è°ƒç”¨å…¶å®ƒå¯¹è±¡çš„æ–¹æ³•ï¼Œå¹¶ä¸”æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶æ ¹æ®éœ€è¦åŠ¨æ€åˆ›å»ºç›®æ ‡ç±»çš„ä»£ç†å¯¹è±¡ã€‚åŠ¨æ€ä»£ç†å°±éœ€è¦å»ºç«‹çœŸå®å¯¹è±¡å’Œä»£ç†å¯¹è±¡å…³ç³»ï¼Œå†å»å®ç°ä»£ç†é€»è¾‘æ–¹æ³•ã€‚<br><strong>Java</strong>ä¸­å®ç°åŠ¨æ€ä»£ç†æœ‰è®¸å¤šæ–¹æ³•ï¼Œ<strong>JDKã€CGLIBã€Javassistã€ASM</strong>ï¼Œå¸¸ç”¨çš„æ˜¯<strong>JDK</strong>å’Œ<strong>CGLIB</strong>ï¼Œåœ¨<strong>spring</strong>ä¸­å°±æ˜¯ä½¿ç”¨äº†è¿™ä¸¤ç§ï¼Œç„¶è€Œ<strong>mybatis</strong>è¿˜æ˜¯ç”¨äº†<strong>Javassist</strong>ã€‚</p><h2 id="2ã€JDKåŠ¨æ€ä»£ç†"><a href="#2ã€JDKåŠ¨æ€ä»£ç†" class="headerlink" title="2ã€JDKåŠ¨æ€ä»£ç†"></a>2ã€JDKåŠ¨æ€ä»£ç†</h2><p>æä¾›ç®€å•çš„æ¥å£ç±»ä»¥åŠå…¶å®ç°ç±»ï¼Œåœ¨é€šè¿‡å»ºç«‹çœŸæ˜¯å¯¹è±¡ä¸ä»£ç†å¯¹è±¡çš„å…³ç³»ï¼Œå¹¶ä¸”å®ç°ä»£ç†é€»è¾‘ã€‚</p><h3 id="1-ã€å‡†å¤‡æ¥å£ç±»"><a href="#1-ã€å‡†å¤‡æ¥å£ç±»" class="headerlink" title="(1)ã€å‡†å¤‡æ¥å£ç±»"></a>(1)ã€å‡†å¤‡æ¥å£ç±»</h3><p>å…ˆæä¾›æ¥å£ç±»ï¼š<br>HelloWorldServiceï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ™®é€šçš„æ¥å£</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HelloWorldService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHelloWorld</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>HelloWorldServiceImplï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.service.HelloWorldService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ¥å£å®ç°ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">HelloWorldService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHelloWorld</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-ã€jdkåŠ¨æ€ä»£ç†"><a href="#2-ã€jdkåŠ¨æ€ä»£ç†" class="headerlink" title="(2)ã€jdkåŠ¨æ€ä»£ç†"></a>(2)ã€jdkåŠ¨æ€ä»£ç†</h3><p>åœ¨JDKåŠ¨æ€ä»£ç†ä¸­ï¼Œé€šè¿‡bindå°†çœŸå®å¯¹è±¡å’Œä»£ç†å¯¹è±¡ç»‘å®šèµ·æ¥ï¼Œå®ç°ä»£ç†é€»è¾‘å°±è¦å»å®ç°<strong>java.lang.reflect.InvocationHandler</strong>æ¥å£ï¼Œå¹¶ä¸”å»å®ç°invokeæ–¹æ³•</p><blockquote><p>â‘ ã€é¦–å…ˆéœ€è¦å£°æ˜ bind æ–¹æ³•å»å»ºç«‹çœŸå®å¯¹è±¡ä¸ä»£ç†å¯¹è±¡çš„å…³ç³»ï¼ŒæŠŠæœ¬ç±»ä¸­çš„targetä¿å­˜çœŸå®å¯¹è±¡ã€‚åœ¨é€šè¿‡Proxyçš„newProxyInstanceæ–¹æ³•æ¥å»ºç«‹å¹¶ç”Ÿæˆå¯¹è±¡ï¼Œtarget.getClass().getClassLoader()ï¼štargetæœ¬èº«çš„ç±»åŠ è½½å™¨ï¼Œtarget.getClass().getInterfaces()ï¼šæŠŠç”Ÿæˆçš„åŠ¨æ€ä»£ç†å¯¹è±¡ä¸‹æŒ‚åœ¨æ¥å£ä¸­ï¼Œthisï¼šå½“å‰å¯¹è±¡ï¼Œæ˜¯å®šä¹‰å®ç°æ–¹æ³•é€»è¾‘çš„ä»£ç†ç±»ã€‚<br>â‘¡ã€å®ç°InvocationHandlerç±»ä¸­çš„invokeæ–¹æ³•ï¼Œå¯ä»¥å®ç°ä»£ç†é€»è¾‘ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨äº†ä»£ç†å¯¹è±¡è°ƒåº¦æ–¹æ³•åå°±ä¼šè¿›å…¥åˆ°invokeæ–¹æ³•ä¸­ã€‚</p></blockquote><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.jdk;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: åŠ¨æ€ä»£ç†ç»‘å®šå’Œä»£ç†é€»è¾‘å®ç°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdkProxyExample</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çœŸå®å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Object</span> <span class="variable">target</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å»ºç«‹ä»£ç†å¯¹è±¡å’ŒçœŸå®å¯¹è±¡çš„ä»£ç†å…³ç³»ï¼Œå¹¶ä¸”è¿”å›ä»£ç†é€»è¾‘å®ç°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> target çœŸå®å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">bind</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target; <span class="comment">// ç»‘å®šå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(), <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»£ç†æ–¹æ³•é€»è¾‘</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> proxy ä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method å½“å‰è°ƒåº¦æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args å½“å‰æ–¹æ³•çš„å‚æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  ä»£ç†ç»“æœè¿”å›</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¿›å…¥ä»£ç†é€»è¾‘æ–¹æ³•&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;åœ¨è°ƒåº¦çœŸå®å¯¹è±¡ä¹‹å‰çš„æœåŠ¡&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> method.invoke(target, args); <span class="comment">// ç›¸å½“äºè°ƒç”¨äº†sayHelloWorldçš„æ–¹æ³•</span></span><br><span class="line">        System.out.println(<span class="string">&quot;åœ¨è°ƒåº¦çœŸå®å¯¹è±¡ä¹‹åçš„æœåŠ¡&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-ã€å®ä¾‹"><a href="#3-ã€å®ä¾‹" class="headerlink" title="(3)ã€å®ä¾‹"></a>(3)ã€å®ä¾‹</h3><p>æµ‹è¯•jdkåŠ¨æ€ä»£ç†<br>é€šè¿‡ <strong>HelloWorldService proxy = (HelloWorldService) jdkProxyExample.bind(new HelloWorldServiceImpl());</strong> å»ä»£ç†å¯¹è±¡ï¼Œç„¶åå°±æ˜¯ä½¿ç”¨proxyå»ç‚¹æ¥å£é‡Œé¢çš„æ–¹æ³•äº†ã€‚<br>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.jdk.JdkProxyExample;</span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.service.HelloWorldService;</span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.service.impl.HelloWorldServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æµ‹è¯•jdkåŠ¨æ€ä»£ç†</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">jdkProxyText</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">JdkProxyExample</span> <span class="variable">jdkProxyExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdkProxyExample</span>();</span><br><span class="line">        <span class="comment">// ç»‘å®šå…³ç³»ï¼Œå› ä¸ºæŒ‚è½½å¸¦æ¥å£ä¸‹ï¼Œå› æ­¤å£°æ˜ä¸€ä¸ªä»£ç†å¯¹è±¡</span></span><br><span class="line">        <span class="type">HelloWorldService</span> <span class="variable">proxy</span> <span class="operator">=</span> (HelloWorldService) jdkProxyExample.bind(<span class="keyword">new</span> <span class="title class_">HelloWorldServiceImpl</span>()); <span class="comment">// å¯¹è±¡æ˜¯new å®ç°ç±»</span></span><br><span class="line">        <span class="comment">// è°ƒç”¨æ–¹æ³•</span></span><br><span class="line">        proxy.sayHelloWorld();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®éªŒç»“æœ<br><img src="https://img-blog.csdnimg.cn/13501d3d09a649d7bf147badf00c75b2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¯ä»¥å¸¦å…¥å‚æ•°ï¼šä»¥ä¸‹æ˜¯å¸¦å…¥å‚æ•°çš„ä¾‹å­</p><blockquote><p>åœ¨æ¥å£ä¸­çš„æ–¹æ³•æ·»åŠ å‚æ•°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHelloWorld</span><span class="params">(String name)</span>;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨å®ç°ç±»çš„å®ç°æ–¹æ³•ä¸­æ‰“å°å‡ºæ¥</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">&quot;Hello World! &quot;</span> + name);</span><br></pre></td></tr></table></figure><p>è°ƒç”¨æ–¹æ³•çš„æ—¶å€™æ·»åŠ å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è°ƒç”¨æ–¹æ³•</span></span><br><span class="line">proxy.sayHelloWorld(<span class="string">&quot;lyd&quot;</span>);</span><br></pre></td></tr></table></figure><p>ä»£ç†æ¨¡å¼ååˆ†é‡è¦ï¼Œè¦ç†è§£é‡Œé¢çš„é€»è¾‘ï¼Œå¯ä»¥é€šè¿‡debugæ‰“æ–­ç‚¹å»ä¸€æ­¥ä¸€æ­¥æŸ¥çœ‹ã€‚</p><h2 id="3ã€CGLIB-åŠ¨æ€ä»£ç†"><a href="#3ã€CGLIB-åŠ¨æ€ä»£ç†" class="headerlink" title="3ã€CGLIB åŠ¨æ€ä»£ç†"></a>3ã€CGLIB åŠ¨æ€ä»£ç†</h2><p>JDKåŠ¨æ€ä»£ç†éœ€è¦æ¥å£æ‰èƒ½å®Œæˆï¼Œè€Œå¦‚æœä¸æä¾›æ¥å£ï¼Œåªæœ‰å®ç°çš„æ–¹æ³•ç±»ï¼Œå¯ä»¥ä½¿ç”¨ä¸‰æ–¹æ’ä»¶CGLIBæ¥åŠ¨æ€ä»£ç†ï¼Œé‡‡ç”¨è¿™ä¸ªåŠ¨æ€ä»£ç†æŠ€æœ¯ï¼Œéœ€è¦å¼•å…¥ä¸‰æ–¹jaråŒ…ï¼Œå¯ä»¥æ­å»ºmavené¡¹ç›®ï¼Œå¼•å…¥CGLIB <strong>jaråŒ…</strong> ï¼Œé€šè¿‡mavenå®˜ç½‘æœç´¢æ·»åŠ ï¼Œäº¦å¯ä»¥ç›´æ¥ä¸‹è½½jaræ–‡ä»¶ã€‚</p><h3 id="1-ã€åŠ å…¥CGLIBä¾èµ–"><a href="#1-ã€åŠ å…¥CGLIBä¾èµ–" class="headerlink" title="(1)ã€åŠ å…¥CGLIBä¾èµ–"></a>(1)ã€åŠ å…¥CGLIBä¾èµ–</h3><p>mavenå¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/cglib/cglib --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-ã€å‡†å¤‡å®ç°ç±»"><a href="#2-ã€å‡†å¤‡å®ç°ç±»" class="headerlink" title="(2)ã€å‡†å¤‡å®ç°ç±»"></a>(2)ã€å‡†å¤‡å®ç°ç±»</h3><p>å‡†å¤‡ä¸€ä¸ªå®ç°ç±»ï¼Œcglibä¸éœ€è¦æ¥å£ï¼Œåªè¦å®ç°å°±å¯ä»¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.impl;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: å®ç°ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldServiceImpl</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHelloWorld</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello World! &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-ã€ä»£ç†ç±»"><a href="#3-ã€ä»£ç†ç±»" class="headerlink" title="(3)ã€ä»£ç†ç±»"></a>(3)ã€ä»£ç†ç±»</h3><p>ä»£ç†ç±»éœ€è¦<strong>MethodInterceptor</strong>å»å®ç°æ–¹æ³•</p><blockquote><p>è¿™é‡Œä½¿ç”¨äº†å¢å¼ºè€…enhancerï¼Œé€šè¿‡è®¾ç½®è¶…ç±»å’Œä½¿ç”¨setCallbackæ–¹æ³•è®¾ç½®ä»£ç†ç±»ï¼ŒCGLIBæ˜¯é€šè¿‡invokeSuperæ–¹æ³•ä»£ç†é€»è¾‘çš„ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.cglib;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.Enhancer;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CglibProxyExample</span> <span class="keyword">implements</span> <span class="title class_">MethodInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”ŸæˆCGLIBå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cls -----å¯¹è±¡ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Classçš„CGLIBä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getProxy</span><span class="params">(Class cls)</span> &#123;</span><br><span class="line">        <span class="comment">//CGLIBçš„å¢å¼ºç±»å¯¹è±¡</span></span><br><span class="line">        <span class="type">Enhancer</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line">        <span class="comment">//è®¾ç½®å¢å¼ºå¯¹è±¡</span></span><br><span class="line">        enhancer.setSuperclass(cls);</span><br><span class="line">        <span class="comment">//å®šä¹‰ä»£ç†é€»è¾‘å¯¹è±¡ä¸ºå½“å‰å¯¹è±¡ï¼Œè¦æ±‚å¯¹è±¡å®ç°MethodInterceptoræ–¹æ³•</span></span><br><span class="line">        enhancer.setCallback(<span class="built_in">this</span>);</span><br><span class="line">        <span class="comment">//ç”Ÿæˆè¿”å›ä»£ç†å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span>  enhancer.create();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»£ç†é€»è¾‘æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> proxy ä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args å‚æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> methodProxy æ–¹æ³•ä»£ç†</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ä»£ç†é€»è¾‘è¿”å›</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable å¼‚å¸¸å¤„ç†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object proxy, Method method, Object[] args, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è°ƒç”¨å¯¹è±¡ä¹‹å‰&quot;</span>);</span><br><span class="line">        <span class="comment">//ä½¿ç”¨CGLIBåå°„çœŸå®å¯¹è±¡çš„æ–¹æ³•</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> methodProxy.invokeSuper(proxy, args);</span><br><span class="line">        System.out.println(<span class="string">&quot;è°ƒç”¨å¯¹è±¡ä¹‹å&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-ã€å®ä¾‹"><a href="#4-ã€å®ä¾‹" class="headerlink" title="(4)ã€å®ä¾‹"></a>(4)ã€å®ä¾‹</h3><p>æµ‹è¯•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.cglib.CglibProxyExample;</span><br><span class="line"><span class="keyword">import</span> com.lyd.demo.impl.HelloWorldServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æµ‹è¯•CGLIB</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CGLIBProxyTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CglibProxyExample</span> <span class="variable">cglibProxyExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CglibProxyExample</span>();</span><br><span class="line">        <span class="type">HelloWorldServiceImpl</span> <span class="variable">proxy</span> <span class="operator">=</span> (HelloWorldServiceImpl) cglibProxyExample.getProxy(HelloWorldServiceImpl.class); <span class="comment">// è·å–å¯¹è±¡,å¯ä»¥ä¸éœ€è¦æ¥å£ç±»</span></span><br><span class="line">        proxy.sayHelloWorld(<span class="string">&quot;lyd&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ç»“æœ<br><img src="https://img-blog.csdnimg.cn/750d26e40ae0495d8890d2facf5f41c7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    
    <summary type="html">åŠ¨æ€ä»£ç†æ˜¯æŒ‡å®¢æˆ·é€šè¿‡ä»£ç†ç±»æ¥è°ƒç”¨å…¶å®ƒå¯¹è±¡çš„æ–¹æ³•ï¼Œå¹¶ä¸”æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶æ ¹æ®éœ€è¦åŠ¨æ€åˆ›å»ºç›®æ ‡ç±»çš„ä»£ç†å¯¹è±¡ã€‚åŠ¨æ€ä»£ç†å°±éœ€è¦å»ºç«‹çœŸå®å¯¹è±¡å’Œä»£ç†å¯¹è±¡å…³ç³»ï¼Œå†å»å®ç°ä»£ç†é€»è¾‘æ–¹æ³•ã€‚</summary>
    
    
    
    <category term="Javaè®¾è®¡æ¨¡å¼" scheme="https://lydandtry.github.io/categories/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://lydandtry.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="Java" scheme="https://lydandtry.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Javaè®¾è®¡æ¨¡å¼-åå°„æœºåˆ¶</title>
    <link href="https://lydandtry.github.io/posts/25987/"/>
    <id>https://lydandtry.github.io/posts/25987/</id>
    <published>2023-06-24T15:02:06.000Z</published>
    <updated>2023-06-27T04:12:01.443Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Javaè®¾è®¡æ¨¡å¼-åå°„æœºåˆ¶"><a href="#Javaè®¾è®¡æ¨¡å¼-åå°„æœºåˆ¶" class="headerlink" title="Javaè®¾è®¡æ¨¡å¼ - åå°„æœºåˆ¶"></a>Javaè®¾è®¡æ¨¡å¼ - åå°„æœºåˆ¶</h1><blockquote><p>&#x1f604; ä¸æ–­å­¦ä¹ æ‰æ˜¯ç‹é“<br>ğŸ”¥ ç»§ç»­è¸ä¸Šå­¦ä¹ ä¹‹è·¯ï¼Œå­¦ä¹‹åˆ†äº«ç¬”è®°<br>ğŸ‘Š æ€»æœ‰ä¸€å¤©æˆ‘ä¹Ÿèƒ½åƒå„ä½å¤§ä½¬ä¸€æ ·<br>ğŸ† å…³æ³¨æˆ‘çš„CSDNï¼š<a href="https://blog.csdn.net/qq_43843951?spm=1011.2415.3001.5343">ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº</a><br>ğŸ‘Š æ‰“ç®—è¿è½½Javaè®¾è®¡æ¨¡å¼ï¼Œè®°å½•è‡ªå·±çš„å­¦ä¹ å¿ƒå¾—ï¼Œåˆ†äº«å­¦ä¹ ç»éªŒã€‚</p></blockquote><h2 id="Javaåå°„æŠ€æœ¯"><a href="#Javaåå°„æŠ€æœ¯" class="headerlink" title="Javaåå°„æŠ€æœ¯"></a>Javaåå°„æŠ€æœ¯</h2><blockquote><p>åå°„çš„åº”ç”¨æœºåˆ¶å¹¿æ³›ï¼Œèƒ½å¤Ÿé…ç½®ç±»çš„å…¨é™å®šå(åŒ…å + ç±»å‹å)ã€æ–¹æ³•å’Œå‚æ•°ï¼Œå®Œæˆå¯¹è±¡çš„åˆå§‹åŒ–ï¼Œå¹¶ä¸”å¯ä»¥å¤§å¤§å¢å¼ºJavaçš„å¯é…ç½®æ€§ï¼ŒSpringIOCçš„åŸºæœ¬åŸç†å°±æ˜¯å¦‚æ­¤ã€‚</p><h3 id="1ã€é€šè¿‡åå°„æ„å»ºå¯¹è±¡"><a href="#1ã€é€šè¿‡åå°„æ„å»ºå¯¹è±¡" class="headerlink" title="1ã€é€šè¿‡åå°„æ„å»ºå¯¹è±¡"></a>1ã€é€šè¿‡åå°„æ„å»ºå¯¹è±¡</h3><p>åå°„æ„å»ºå¯¹è±¡å¯ä»¥æ˜¯æœ‰å‚å’Œæ— å‚ã€‚<br><strong>æ— å‚ï¼š</strong><br>å…ˆå®šä¹‰<strong>ReflectDemo</strong>ç±»ï¼Œå¹¶ä¸”æœ‰ä¸ªæ— å‚æ•°çš„æ–¹æ³•ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åå°„æœºåˆ¶ï¼ï¼ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡åå°„å»æ„å»ºå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡åå°„å»æ„å»º</span></span><br><span class="line"><span class="keyword">public</span> ReflectDemo <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ReflectDemo</span> <span class="variable">object</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        object = (ReflectDemo) Class.forName(<span class="string">&quot;com.lyd.demo.reflect.ReflectDemo&quot;</span>).newInstance();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯é€šè¿‡<strong>Class</strong>çš„<strong>forName()</strong>å»æ‰¾åˆ°è¿™ä¸ªç±»ï¼Œåœ¨é€šè¿‡<strong>newInstance()</strong>æ–¹æ³•åˆ›å»ºå®ä¾‹ã€‚<br>ç»™ç±»åŠ è½½å™¨å»æ³¨å†Œäº†ä¸€ä¸ªç±»<strong>ReflectDemo</strong>çš„å…¨é™å®šå</p><blockquote><p>object = (ReflectDemo) Class.forName(â€œcom.lyd.demo.reflect.ReflectDemoâ€).newInstance();</p></blockquote><p>å«å‚:<br>å…ˆå®šä¹‰<strong>ReflectParamDemo</strong>ç±»ï¼Œå¹¶ä¸”æœ‰ä¸ªå«å‚æ•°çš„æ–¹æ³•ä»¥åŠå…¶æ„é€ æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectParamDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ReflectParamDemo</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åå­—: &quot;</span> + name + <span class="string">&quot; å¹´é¾„: &quot;</span> + age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·ï¼Œæ ¹æ®Class.forNameå»åˆ›å»ºå®ä¾‹ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéœ€è¦åŠ ä¸Šå‚æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡åå°„å»æ„å»º</span></span><br><span class="line"><span class="keyword">public</span> ReflectParamDemo <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ReflectParamDemo</span> <span class="variable">object</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        object = (ReflectParamDemo) Class.forName(<span class="string">&quot;com.lyd.demo.reflect.ReflectParamDemo&quot;</span>)</span><br><span class="line">                .getConstructor(String.class, <span class="type">int</span>.class)</span><br><span class="line">                .newInstance(<span class="string">&quot;æå››&quot;</span>, <span class="number">18</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>getConstructor()ï¼Œå¸¦å…¥å‚æ•°ç±»å‹</p><blockquote><p>object = (ReflectParamDemo) Class.forName(â€œcom.lyd.demo.reflect.ReflectParamDemoâ€)<br>.getConstructor(String.class, int.class)<br>.newInstance(â€œæå››â€, 18);</p></blockquote><h3 id="2ã€åå°„æ–¹æ³•"><a href="#2ã€åå°„æ–¹æ³•" class="headerlink" title="2ã€åå°„æ–¹æ³•"></a>2ã€åå°„æ–¹æ³•</h3><p>æ— å‚ï¼š<br>æš‚æ—¶å…ˆæ¼”ç¤ºåå°„æ–¹æ³•ï¼Œæ‰€ä»¥ç”¨<strong>new</strong>çš„æ–¹æ³•æ¥åˆ›å»ºå®ä¾‹<strong>target</strong>ï¼Œå…·ä½“çš„ä»£ç è¯·çœ‹å®ä¾‹ï¼Œ é€šè¿‡<strong>ReflectDemo.class.getMethod(â€œsayHelloâ€);</strong>å¯ä»¥è·å–åˆ°ç±»ä¸­çš„æ–¹æ³•ï¼Œå¹¶ä¸”é€šè¿‡invoke<strong>åŠ ç²—æ ·å¼</strong>æ–¹æ³•å®Œæˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åå°„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">reflectMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">retuenObj</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">ReflectDemo</span> <span class="variable">target</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReflectDemo</span>();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectDemo.class.getMethod(<span class="string">&quot;sayHello&quot;</span>);</span><br><span class="line">        retuenObj = method.invoke(target);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> retuenObj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>target: æŒ‡å®šå¯¹è±¡<br>invoke(target)ï¼šè°ƒç”¨å“ªä¸ªå¯¹è±¡ä¸­çš„æ–¹æ³•ï¼Œå¦‚æœæ˜¯å«å‚çš„ï¼Œå¯ä»¥åœ¨åé¢æ·»åŠ å‚æ•°ï¼Œå¯ä»¥æ˜¯å¤šä¸ªå‚æ•°</p></blockquote><h3 id="3ã€å®ä¾‹ï¼š"><a href="#3ã€å®ä¾‹ï¼š" class="headerlink" title="3ã€å®ä¾‹ï¼š"></a>3ã€å®ä¾‹ï¼š</h3><p>ç»¼åˆåå°„å¯¹è±¡ä¸æ–¹æ³•<br>æ— å‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®ä¾‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">reflect</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ReflectDemo</span> <span class="variable">object</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        object = (ReflectDemo) Class.forName(<span class="string">&quot;com.lyd.demo.reflect.ReflectDemo&quot;</span>).newInstance();</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectDemo.class.getMethod(<span class="string">&quot;sayHello&quot;</span>);</span><br><span class="line">        method.invoke(object);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å«å‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®ä¾‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">reflect</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ReflectParamDemo</span> <span class="variable">object</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        object = (ReflectParamDemo) Class.forName(<span class="string">&quot;com.lyd.demo.reflect.ReflectParamDemo&quot;</span>)</span><br><span class="line">                .getConstructor(String.class, <span class="type">int</span>.class)</span><br><span class="line">                .newInstance(<span class="string">&quot;æå››&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectParamDemo.class.getMethod(<span class="string">&quot;sayHello&quot;</span>, String.class, <span class="type">int</span>.class);</span><br><span class="line">        method.invoke(object, <span class="string">&quot;æå››&quot;</span>, <span class="number">18</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ä½“ä»£ç "><a href="#æ€»ä½“ä»£ç " class="headerlink" title="æ€»ä½“ä»£ç "></a>æ€»ä½“ä»£ç </h2><p>ReflectDemoï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.reflect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: åå°„æœºåˆ¶-æ— å‚æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åå°„æœºåˆ¶ï¼ï¼ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡åå°„å»æ„å»º</span></span><br><span class="line">    <span class="keyword">public</span> ReflectDemo <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ReflectDemo</span> <span class="variable">object</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            object = (ReflectDemo) Class.forName(<span class="string">&quot;com.lyd.demo.reflect.ReflectDemo&quot;</span>).newInstance();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åå°„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">reflectMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">retuenObj</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ReflectDemo</span> <span class="variable">target</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReflectDemo</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectDemo.class.getMethod(<span class="string">&quot;sayHello&quot;</span>);</span><br><span class="line">            retuenObj = method.invoke(target);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> retuenObj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®ä¾‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">reflect</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ReflectDemo</span> <span class="variable">object</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            object = (ReflectDemo) Class.forName(<span class="string">&quot;com.lyd.demo.reflect.ReflectDemo&quot;</span>).newInstance();</span><br><span class="line">            <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectDemo.class.getMethod(<span class="string">&quot;sayHello&quot;</span>);</span><br><span class="line">            method.invoke(object);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ReflectParamDemoï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.reflect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: åå°„æœºåˆ¶-å¸¦å‚æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectParamDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ReflectParamDemo</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åå­—: &quot;</span> + name + <span class="string">&quot; å¹´é¾„: &quot;</span> + age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡åå°„å»æ„å»º</span></span><br><span class="line">    <span class="keyword">public</span> ReflectParamDemo <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ReflectParamDemo</span> <span class="variable">object</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            object = (ReflectParamDemo) Class.forName(<span class="string">&quot;com.lyd.demo.reflect.ReflectParamDemo&quot;</span>)</span><br><span class="line">                    .getConstructor(String.class, <span class="type">int</span>.class)</span><br><span class="line">                    .newInstance(<span class="string">&quot;æå››&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®ä¾‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">reflect</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ReflectParamDemo</span> <span class="variable">object</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            object = (ReflectParamDemo) Class.forName(<span class="string">&quot;com.lyd.demo.reflect.ReflectParamDemo&quot;</span>)</span><br><span class="line">                    .getConstructor(String.class, <span class="type">int</span>.class)</span><br><span class="line">                    .newInstance(<span class="string">&quot;æå››&quot;</span>, <span class="number">18</span>);</span><br><span class="line">            <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectParamDemo.class.getMethod(<span class="string">&quot;sayHello&quot;</span>, String.class, <span class="type">int</span>.class);</span><br><span class="line">            method.invoke(object, <span class="string">&quot;æå››&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼šReflectTest</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyd.demo.reflect;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: åå°„æœºåˆ¶æµ‹è¯•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022-08-14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ReflectDemo.reflect();</span><br><span class="line">        ReflectParamDemo.reflect();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç»“æœ:<br><img src="https://s2.loli.net/2023/06/24/F39akm5z4SctlDY.png" alt="æˆªå›¾.png"></p>]]></content>
    
    
    <summary type="html">åå°„çš„åº”ç”¨æœºåˆ¶å¹¿æ³›ï¼Œèƒ½å¤Ÿé…ç½®ç±»çš„å…¨é™å®šå(åŒ…å + ç±»å‹å)ã€æ–¹æ³•å’Œå‚æ•°ï¼Œå®Œæˆå¯¹è±¡çš„åˆå§‹åŒ–ï¼Œå¹¶ä¸”å¯ä»¥å¤§å¤§å¢å¼ºJavaçš„å¯é…ç½®æ€§ï¼ŒSpringIOCçš„åŸºæœ¬åŸç†å°±æ˜¯å¦‚æ­¤ã€‚</summary>
    
    
    
    <category term="Javaè®¾è®¡æ¨¡å¼" scheme="https://lydandtry.github.io/categories/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://lydandtry.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="Java" scheme="https://lydandtry.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>é”çš„æœºåˆ¶ä¸åº•å±‚ä¼˜åŒ–åŸç†</title>
    <link href="https://lydandtry.github.io/posts/53870/"/>
    <id>https://lydandtry.github.io/posts/53870/</id>
    <published>2023-06-19T20:13:33.000Z</published>
    <updated>2023-06-27T04:12:01.443Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ã€å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘ã€‘-é”çš„æœºåˆ¶ä¸åº•å±‚ä¼˜åŒ–åŸç†"><a href="#ã€å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘ã€‘-é”çš„æœºåˆ¶ä¸åº•å±‚ä¼˜åŒ–åŸç†" class="headerlink" title="ã€å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘ã€‘- é”çš„æœºåˆ¶ä¸åº•å±‚ä¼˜åŒ–åŸç†"></a>ã€å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘ã€‘- é”çš„æœºåˆ¶ä¸åº•å±‚ä¼˜åŒ–åŸç†</h1><p><img src="https://s2.loli.net/2023/06/21/8OdFqoz1WukpYaS.jpg" alt="é”çš„æœºåˆ¶ä¸åº•å±‚ä¼˜åŒ–åŸç†.jpg"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘ç»å¸¸ç ”ç©¶ä¸€äº›å…³äºçº¿ç¨‹å¹¶å‘çš„é—®é¢˜ï¼Œå†å¼€å‘ä¸­ä¹Ÿå®å®åœ¨åœ¨é‡åˆ°è¿‡è®¸å¤šçš„å¹¶å‘é—®é¢˜ï¼Œä¹‹å‰æ‰€å­¦çš„æ˜¯å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ï¼Œç„¶è€Œæ¥ä¸‹æ¥å°±å¾—ç†è§£ä¸€ä¸‹åº•å±‚åŸç†ã€‚</p><h2 id="ç®€å•ä¾‹å­"><a href="#ç®€å•ä¾‹å­" class="headerlink" title="ç®€å•ä¾‹å­"></a>ç®€å•ä¾‹å­</h2><p>é¦–å…ˆç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¿›è¡Œå¯¹é”çš„å¼€ç¯‡è®¤çŸ¥ã€‚</p><p>å¦‚ä¸‹ä»£ç ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±»ï¼Œåœ¨è¿™ä¸ªç±»ä¸­æä¾›äº†ä¸€ä¸ªè‡ªå¢çš„æ–¹æ³•ã€‚æˆ‘ä»¬é€šè¿‡å¤šçº¿ç¨‹çš„æ–¹å¼å»æ‰§è¡Œè‡ªå¢ï¼Œå¹¶ä¸”ä¸»çº¿ç¨‹ä¹ŸåŠ å…¥è¿›è¡Œè‡ªå¢ï¼Œæœ€åè¾“å‡ºè¿™ä¸ªå€¼ã€‚è¿™æ®µä»£ç éƒ½çŸ¥é“åœ¨è‡ªå¢çš„æ—¶å€™ä¼šå‡ºç°å¹¶å‘é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨é€šè¿‡åŠ é”ï¼Œæ§åˆ¶å¯¹äº’æ–¥èµ„æºçš„è®¿é—®ï¼Œæœ€åå°±èƒ½å¾—åˆ°æœŸæœ›çš„å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Number</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNum</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoAccretion</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="built_in">this</span>) &#123;</span><br><span class="line">            num++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestNum</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Number</span> <span class="variable">number</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Number</span>();</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000000</span>; i++) &#123;</span><br><span class="line">                number.autoAccretion(); <span class="comment">// è‡ªå¢</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        thread.start();</span><br><span class="line">        <span class="comment">// ä¸»çº¿ç¨‹ä¹Ÿæ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000000</span>; i++) &#123;</span><br><span class="line">            number.autoAccretion();</span><br><span class="line">        &#125;</span><br><span class="line">        thread.join();</span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(String.format(<span class="string">&quot;%sms&quot;</span>, endTime - startTime));</span><br><span class="line">        System.out.println(number.num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡æ‰§è¡Œä¼šå‘ç°ï¼Œè¿™ä¸ªå€¼å¹¶ä¸æ˜¯æˆ‘ä»¬æœŸæœ›æ‰€å¾—åˆ°çš„ï¼Œè¿™æ˜¯å› ä¸ºè¿™é‡Œé¢å‡ºç°äº†å¹¶å‘çš„é—®é¢˜ã€‚</p><p><img src="https://s2.loli.net/2023/06/21/Xwq4smxauUvz1ZV.png" alt="image-20230603143159955.png"></p><p>å½“ç„¶ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“è¦æƒ³è§£å†³è¿™ä¸ªå¹¶å‘é—®é¢˜ï¼Œåªéœ€è¦åœ¨è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ä¸ŠåŠ ä¸Š<code>synchronized</code> å°±è¡Œã€‚</p><h2 id="é”çš„æœºåˆ¶"><a href="#é”çš„æœºåˆ¶" class="headerlink" title="é”çš„æœºåˆ¶"></a>é”çš„æœºåˆ¶</h2><p>é€šè¿‡ä»¥ä¸Šä»£ç ï¼Œæˆ‘ä»¬ä½¿ç”¨synchronizedé”æ¥æ§åˆ¶å¯¹num++çš„æ‰§è¡Œï¼Œå½“å¤šä¸ªçº¿ç¨‹è¿›æ¥çš„æ—¶å€™ï¼Œåªæœ‰ä¸€ä¸ªé”èƒ½æ‹¿åˆ°synchronizedè¿™æŠŠé”ã€‚</p><h3 id="1ã€jdk1-6ä¹‹å‰"><a href="#1ã€jdk1-6ä¹‹å‰" class="headerlink" title="1ã€jdk1.6ä¹‹å‰"></a>1ã€jdk1.6ä¹‹å‰</h3><p>åœ¨jdk1.6ä»¥å‰ï¼ŒçœŸæ­£åŠ é”çš„å¯¹è±¡æ˜¯synchronizedå†…éƒ¨çš„monitorå¯¹è±¡[1]ï¼›é‚£ä¹ˆï¼Œå¦‚æœæ‹¿ä¸åˆ°synchronizedé”çš„çº¿ç¨‹æœ€åä¼šæ˜¯æ€æ ·çš„å‘¢ï¼Ÿä»–ä¼šæ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼ˆå³é‡é‡çº§é”ï¼‰ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾åæ‰èƒ½è®©ä¸‹ä¸ªçº¿ç¨‹æ‹¿åˆ°é”ï¼Œè¿™æ˜¯jdk1.6ä»¥å‰çš„åšæ³•ï¼Œå¦‚æœä¸€ç›´ä¸é‡Šæ”¾é”ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´è¿™äº›ç­‰å¾…çº¿ç¨‹ä¸€ç›´å¤„äºç­‰å¾…ï¼Œå¾ˆæ˜æ˜¾è¿™æ ·ä¼šå¯¼è‡´æ€§èƒ½çš„é—®é¢˜ã€‚</p><p>åœ¨æ¥è¯´ä¸€ä¸‹é‡é‡çº§é”ï¼Œåœ¨åº•å±‚å¯èƒ½å‡ºç°çº¿ç¨‹é˜»å¡ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œç­‰å¾…å¾—åˆ°é”çš„çº¿ç¨‹å°†é”é‡Šæ”¾æ‰ï¼Œé€šè¿‡æ“ä½œç³»ç»Ÿå¯¹çº¿ç¨‹çš„è°ƒåº¦ï¼Œå°†é˜»å¡æ€çš„çº¿ç¨‹å”¤é†’ã€‚æ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹çš„åˆ‡æ¢è¿˜éœ€è¦ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°æ ¸å¿ƒæ€ï¼Œæˆæœ¬éå¸¸é«˜ã€‚</p><blockquote><p>[1]åœ¨æ“ä½œç³»ç»Ÿå’Œå¹¶å‘ç¼–ç¨‹é¢†åŸŸä¸­ï¼ŒMonitorï¼ˆç›‘è§†å™¨ï¼‰æ˜¯ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œç”¨äºæ§åˆ¶å¯¹å…±äº«èµ„æºçš„è®¿é—®ã€‚å®ƒå¯ä»¥ç”¨äºç¡®ä¿åœ¨ä»»ä½•æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¿›å…¥ä¸´ç•ŒåŒºï¼ˆCritical Sectionï¼‰å¹¶æ‰§è¡Œç›¸å…³æ“ä½œï¼Œä»è€Œå®ç°çº¿ç¨‹å®‰å…¨ã€‚</p></blockquote><p><img src="https://s2.loli.net/2023/06/21/nXSZyt19IWE8khG.png" alt="çº¿ç¨‹é”1.png"></p><h3 id="2ã€CASæœºåˆ¶"><a href="#2ã€CASæœºåˆ¶" class="headerlink" title="2ã€CASæœºåˆ¶"></a>2ã€CASæœºåˆ¶</h3><p>CASï¼ˆCompare and Swapï¼‰ç®€å•è¯´å°±æ˜¯æ¯”è¾ƒå¹¶äº¤æ¢ï¼Œå®ƒæ˜¯ä¸€ç§å¹¶å‘ç¼–ç¨‹ä¸­å¸¸ç”¨çš„åŸå­æ“ä½œï¼Œç”¨äºå®ç°æ— é”çš„çº¿ç¨‹å®‰å…¨æ“ä½œã€‚å®ƒé€šå¸¸ç”¨äºè§£å†³å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹åŒä¸€ä¸ªå…±äº«å˜é‡è¿›è¡Œä¿®æ”¹çš„ç«äº‰é—®é¢˜ã€‚æˆ‘ä»¬é€šå¸¸å°†casç§°ä¸ºæ— é”ã€è‡ªæ—‹é”ã€ä¹è§‚é”ä»¥åŠè½»é‡çº§é”ã€‚</p><blockquote><p>CASæ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°ï¼šå†…å­˜ä½ç½®ï¼ˆæˆ–ç§°ä¸ºæœŸæœ›å€¼ï¼‰ï¼Œå½“å‰å€¼å’Œæ–°å€¼ã€‚CASæ“ä½œä¼šæ¯”è¾ƒå†…å­˜ä½ç½®çš„å½“å‰å€¼ä¸æœŸæœ›å€¼æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™å°†å†…å­˜ä½ç½®çš„å€¼æ›´æ–°ä¸ºæ–°å€¼ï¼›å¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™ä¸è¿›è¡Œä»»ä½•æ“ä½œã€‚CASæ“ä½œæ˜¯åŸå­çš„ï¼Œå³åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹ä¸­æ–­ã€‚å®ƒé€šè¿‡æ¯”è¾ƒå½“å‰å€¼å’ŒæœŸæœ›å€¼æ¥ç¡®å®šå†…å­˜ä½ç½®æ˜¯å¦è¢«ä¿®æ”¹ï¼Œä»è€Œé¿å…äº†ä¼ ç»Ÿçš„é”æœºåˆ¶å¸¦æ¥çš„ç«äº‰å’Œé˜»å¡ã€‚</p></blockquote><p>CASçš„å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š</p><p>â€‹        â‘ è·å–å†…å­˜ä¸­çš„åŸå§‹å€¼ï¼Œå³å¤‡ä»½æ•°æ®ã€‚</p><p>â€‹        â‘¡è¿›è¡Œæ¯”è¾ƒï¼Œå°†å½“å‰å€¼ä¸æœŸæœ›å€¼è¿›è¡Œæ¯”å¯¹çœ‹æ˜¯å¦ç›¸ç­‰ã€‚</p><p>â€‹        â‘¢å¦‚æœç›¸ç­‰ï¼Œå°±å°†å½“å‰å€¼è¦†ç›–æ—§çš„å€¼ï¼Œåä¹‹é€šè¿‡å¾ªç¯ï¼Œé‡å¤æ“ä½œï¼Œç›´åˆ°è·å¾—åˆ°å¯¹çš„å€¼ã€‚</p><p>æˆ‘ä»¬æœ€å¸¸è§çš„AtomicIntegerç±»ï¼Œä»–å°±æ˜¯å±äºåŸå­æ€§æ“ä½œçš„ï¼Œå®ƒå¯ä»¥åœ¨å¹¶å‘ç¯å¢ƒä¸‹è¿›è¡ŒåŸå­æ“ä½œï¼Œç¡®ä¿å¯¹æ•´æ•°çš„æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚ä¸‹ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªç±»çš„è‡ªå¢æ–¹æ³•æ¥æ›¿æ¢ç”¨synchronizedé”åŒ…å›´çš„è‡ªå¢è¿ç®—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoAccretion</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//        synchronized (this) &#123;</span></span><br><span class="line">    <span class="comment">//            num++;</span></span><br><span class="line">    <span class="comment">//        &#125;</span></span><br><span class="line">    atomicInteger.incrementAndGet();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹å®ƒçš„åº•å±‚ä»£ç ï¼Œé€šè¿‡unsafeç±»è°ƒç”¨è‡ªå¢æ–¹æ³•ï¼Œå®é™…åº•å±‚åŸç†ä¹Ÿæ˜¯è¿›è¡Œæ¯”è¾ƒäº¤æ¢çš„è§„åˆ™æ¥ä¿è¯åŸå­æ€§ã€‚ä¼šå…ˆè·å–å†…éƒ¨åŸå§‹çš„å€¼ï¼Œåœ¨å°†è¿™ä¸ªå€¼è‡ªå¢1ï¼Œåœ¨è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå½“å‰å€¼ç­‰äºæœŸæœ›å€¼ï¼Œåˆ™è‡ªåŠ¨å°†å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ¯”è¾ƒä¸ç›¸ç­‰ï¼Œå¯èƒ½æ˜¯åœ¨è·å–åŸå§‹å€¼ä¹‹ååšè‡ªå¢çš„æ—¶å€™ï¼ŒåŸå§‹å€¼å·²ç»è¢«å…¶ä»–çº¿ç¨‹ç»™æ“ä½œæˆåŠŸè¦†ç›–äº†ï¼Œåˆ™è¿™ä¸ªæ–°çš„å€¼æ˜¯é”™è¯¯ï¼Œéœ€è¦åˆ·æ–°å¤‡ä»½æ•°æ®ï¼Œå†å»å¾ªç¯å°è¯•ï¼Œç›´åˆ°å¾—åˆ°å¯¹çš„æ•°æ®æ‰ä¼šå»åˆ·æ–°æ—§å€¼ã€‚å¤§é‡çš„çº¿ç¨‹è¿‡æ¥æ‰§è¡Œè¿™ä¸ªcompareAndSetæ–¹æ³•ï¼Œå¦‚æœåœ¨æ‰§è¡Œçš„æ—¶å€™æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹æ‰§è¡Œï¼Œé‚£å°±èƒ½å¤Ÿå°†æ–°çš„å€¼å°†æ—§çš„å€¼æ›¿æ¢æ‰ï¼Œå°±ç®—è¯´æ˜¯å¤±è´¥äº†ï¼Œèƒ½å¤Ÿé€šè¿‡å¾ªç¯ç»§ç»­æ‰§è¡Œï¼Œåœ¨å¤šçº¿ç¨‹çš„æ‰§è¡Œèƒ½å¤Ÿç¡®ä¿æ•°æ®çš„æ­£ç¡®æ€§ï¼Œè‡³äºçº¿ç¨‹çš„å…ˆåæ‰§è¡Œä¹Ÿåªæ˜¯çœ‹è¿æ°”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">incrementAndGet</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> unsafe.getAndAddInt(<span class="built_in">this</span>, valueOffset, <span class="number">1</span>) + <span class="number">1</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//unsafe.class</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndAddInt</span><span class="params">(Object var1, <span class="type">long</span> var2, <span class="type">int</span> var4)</span> &#123;</span><br><span class="line">    <span class="type">int</span> var5;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        var5 = <span class="built_in">this</span>.getIntVolatile(var1, var2);</span><br><span class="line">    &#125; <span class="keyword">while</span>(!<span class="built_in">this</span>.compareAndSwapInt(var1, var2, var5, var5 + var4)); <span class="comment">// æœ€åçš„åº•å±‚åŸç†é€šè¿‡å¾ªç¯è‡ªå¤‡ä»½ï¼Œè‡ªå¢ä¸æ¯”è¾ƒ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> var5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å†…éƒ¨ä»£ç æ˜¯çœ‹ä¸åˆ°çš„ï¼Œå®ƒåº•å±‚æ˜¯é€šè¿‡c++ç¼–å†™çš„ã€‚Javaä¸­çš„CASæ“ä½œéƒ½æ˜¯é€šè¿‡sunåŒ…ä¸‹Unsafeç±»å®ç°ï¼Œè€ŒUnsafeç±»ä¸­çš„æ–¹æ³•éƒ½æ˜¯nativeæ–¹æ³•ï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•çš„å®ç°æ˜¯ç”±å¤–éƒ¨çš„æœ¬åœ°ä»£ç ï¼Œè¿™é‡Œæˆ‘ä¸‹è½½äº†lookaside_java-1.8.0-openjdkçš„æºç (å¯ä»¥ä»githubä¸Šæ‹‰å–)ï¼Œå¯ä»¥ä»hoståº•å±‚æ¥çœ‹æºç ã€‚</p><p><img src="https://s2.loli.net/2023/06/21/tV47NXn3DfHAEK8.png" alt="image-20230612205419845.png"></p><p>å°±AtomicIntegerå†…çš„compareAndSwapIntæ–¹æ³•ï¼Œæˆ‘ä»¬é€šè¿‡jdk1.8çš„ <code>hotspot/src/share/vm/prims/unsafe.cpp</code> ä¸‹çš„æºç å¯ä»¥çœ‹åˆ°åº•å±‚ç”±c++ç¼–å†™ã€‚å®ƒä½¿ç”¨åŸå­æ¯”è¾ƒå’Œäº¤æ¢æ“ä½œæ¥æ¯”è¾ƒå’Œæ›¿æ¢æŒ‡å®šå†…å­˜åœ°å€ä¸Šçš„æ•´æ•°å€¼ï¼Œå¹¶è¿”å›æ¯”è¾ƒç»“æœã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UNSAFE_ENTRY</span>(jboolean, <span class="built_in">Unsafe_CompareAndSwapInt</span>(JNIEnv *env, jobject unsafe, jobject obj, jlong offset, jint e, jint x))</span><br><span class="line">  <span class="built_in">UnsafeWrapper</span>(<span class="string">&quot;Unsafe_CompareAndSwapInt&quot;</span>);</span><br><span class="line">  <span class="comment">// We are about to write to this entry so check to see if we need to copy it.</span></span><br><span class="line">  <span class="comment">// æ‰§è¡Œäº†ä¸€ä¸ªå†™å±éšœæ“ä½œï¼ˆwrite barrierï¼‰ï¼Œç”¨äºä¿è¯åœ¨ä¿®æ”¹å¯¹è±¡ä¹‹å‰è¿›è¡Œå¿…è¦çš„å¤„ç†ã€‚</span></span><br><span class="line">  <span class="comment">// JNIHandles::resolve(obj)å°†objä»JNIå¥æŸ„è§£æä¸ºJavaå¯¹è±¡ï¼Œå¹¶ä½¿ç”¨oopDesc::bs()æ‰§è¡Œå†™å±éšœæ“ä½œã€‚</span></span><br><span class="line">  oop p = oopDesc::<span class="built_in">bs</span>()-&gt;<span class="built_in">write_barrier</span>(JNIHandles::<span class="built_in">resolve</span>(obj));</span><br><span class="line">  jint* addr = (jint *) <span class="built_in">index_oop_from_field_offset_long</span>(p, offset);<span class="comment">// è®¡ç®—å‡ºè¦è¿›è¡ŒåŸå­æ¯”è¾ƒå’Œäº¤æ¢æ“ä½œçš„å†…å­˜åœ°å€</span></span><br><span class="line">  <span class="keyword">return</span> (jint)(Atomic::<span class="built_in">cmpxchg</span>(x, addr, e)) == e; <span class="comment">// æ ¸å¿ƒä»£ç  æ‰§è¡ŒåŸå­çš„æ¯”è¾ƒå’Œäº¤æ¢æ“ä½œ</span></span><br><span class="line">UNSAFE_END</span><br></pre></td></tr></table></figure><blockquote><p><strong>(jint)(Atomic::cmpxchg(x, addr, e)) == e;</strong>: è¿™ä¸€è¡Œä»£ç æ˜¯ä¸»è¦çš„æ ¸å¿ƒä»£ç ï¼Œä½¿ç”¨<strong>Atomic::cmpxchg</strong>å‡½æ•°æ‰§è¡ŒåŸå­çš„æ¯”è¾ƒå’Œäº¤æ¢æ“ä½œã€‚å®ƒå°è¯•å°†<strong>addr</strong>æŒ‡å‘çš„å†…å­˜åœ°å€ä¸Šçš„å€¼ä¸eè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™å°†å…¶æ›¿æ¢ä¸ºxã€‚æœ€åï¼Œå®ƒå°†æ¯”è¾ƒç»“æœä¸eè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚</p></blockquote><p>æ¥ä¸‹æ¥åœ¨jdk1.8çš„æºç ï¼šatomic_linux_x86.inline.hppä¸­çœ‹ä¸€ä¸‹è¿™ä¸ªæ ¸å¿ƒä»£ç çš„åº•å±‚é€»è¾‘ï¼Œè¿™æ®µä»£ç ä¼šå…ˆé€šè¿‡æ“ä½œç³»ç»Ÿçš„å†…æ ¸æ–¹æ³•åˆ¤æ–­æ˜¯å¦ä¸ºå¤šå¤„ç†å™¨ç³»ç»Ÿï¼Œåœ¨é€šè¿‡LOCK_IF_MPè·å–lockæŒ‡ä»¤ï¼Œå®é™…ä¸Šæ‹¿åˆ°çš„æ±‡ç¼–æŒ‡ä»¤lockä¸cmpxchglæ¥å®ç°åŸå­æ€§ã€‚å½“æ‹¿åˆ°lockæŒ‡ä»¤çš„æ—¶å€™å°±èƒ½ç»™è¿›è¡Œæ¯”è¾ƒå¹¶äº¤æ¢ï¼Œæ²¡æœ‰å¾—åˆ°é”çš„æƒ…å†µéœ€è¦ç­‰å¾…é”è¢«é‡Šæ”¾ï¼Œè¿™å°±è¾¾åˆ°äº†åŸå­æ€§é—®é¢˜ã€‚å½“ç¼“å­˜ä¸æ˜¯å¾ˆå¤§çš„æƒ…å†µæ˜¯ä½¿ç”¨ç¼“å­˜è¡Œé”ï¼Œä½†å¦‚æœè¶…è¿‡äº†ç¼“å­˜è¡Œå¤§å°ï¼Œå°±ä¼šä½¿ç”¨æ€»çº¿é”ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> jint <span class="title">Atomic::cmpxchg</span> <span class="params">(jint exchange_value, <span class="keyword">volatile</span> jint* dest, jint compare_value)</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> mp = os::<span class="built_in">is_MP</span>(); <span class="comment">// è°ƒç”¨æ“ä½œç³»ç»Ÿå†…æ ¸æ–¹æ³•ç”¨äºåˆ¤æ–­å½“å‰çš„ç³»ç»Ÿæ˜¯å¦ä¸ºå¤šå¤„ç†å™¨ç³»ç»Ÿã€‚</span></span><br><span class="line">  <span class="comment">// LOCK_IF_MPè·å–lockæŒ‡ä»¤ï¼Œä»–æ˜¯åˆ¤æ–­æ˜¯å¦ä½å¤šå¤„ç†å™¨</span></span><br><span class="line">  <span class="function">__asm__ <span class="title">volatile</span> <span class="params">(LOCK_IF_MP(%<span class="number">4</span>) <span class="string">&quot;cmpxchgl %1,(%3)&quot;</span> <span class="comment">// æ±‡ç¼–æŒ‡ä»¤ï¼Œå‰é¢å·²ç»å®šä¹‰#define LOCK_IF_MP(mp) &quot;cmp $0, &quot; #mp &quot;; je 1f; lock; 1: &quot;</span></span></span></span><br><span class="line"><span class="params"><span class="function">                    : <span class="string">&quot;=a&quot;</span> (exchange_value)</span></span></span><br><span class="line"><span class="params"><span class="function">                    : <span class="string">&quot;r&quot;</span> (exchange_value), <span class="string">&quot;a&quot;</span> (compare_value), <span class="string">&quot;r&quot;</span> (dest), <span class="string">&quot;r&quot;</span> (mp)</span></span></span><br><span class="line"><span class="params"><span class="function">                    : <span class="string">&quot;cc&quot;</span>, <span class="string">&quot;memory&quot;</span>)</span></span>;</span><br><span class="line">  <span class="keyword">return</span> exchange_value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Synchronizedåº•å±‚çš„é”ä¼˜åŒ–æœºåˆ¶"><a href="#Synchronizedåº•å±‚çš„é”ä¼˜åŒ–æœºåˆ¶" class="headerlink" title="Synchronizedåº•å±‚çš„é”ä¼˜åŒ–æœºåˆ¶"></a>Synchronizedåº•å±‚çš„é”ä¼˜åŒ–æœºåˆ¶</h2><h3 id="1ã€é”çš„çŠ¶æ€å‡çº§å˜è¿"><a href="#1ã€é”çš„çŠ¶æ€å‡çº§å˜è¿" class="headerlink" title="1ã€é”çš„çŠ¶æ€å‡çº§å˜è¿"></a>1ã€é”çš„çŠ¶æ€å‡çº§å˜è¿</h3><p>åœ¨jdk1.6ä»¥åSynchronizedé”å¼•ç”¨äº†è®¸å¤šçŠ¶æ€åˆ‡æ¢ï¼šæ— çŠ¶æ€ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ï¼Œæ ¹æ®ä¸åŒçš„æ¡ä»¶è¿›è¡ŒçŠ¶æ€çš„åˆ‡æ¢å‡çº§ï¼Œèƒ½å¤Ÿåœ¨ä¸€å®šçš„ç¨‹åº¦ä¸­ä½¿æ€§èƒ½æå‡ã€‚</p><h4 id="1-ã€é”çŠ¶æ€mark-wordç»“æ„"><a href="#1-ã€é”çŠ¶æ€mark-wordç»“æ„" class="headerlink" title="(1)ã€é”çŠ¶æ€mark wordç»“æ„"></a>(1)ã€é”çŠ¶æ€mark wordç»“æ„</h4><p>synchronizedé”åœ¨çº¿ç¨‹ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯æ²¡æœ‰åŠ é”çš„ï¼Œåªæ˜¯åœ¨mark wordä¸­è®°å½•äº†çº¿ç¨‹IDï¼Œè¿™ç§å°±æ˜¯åå‘é”ï¼Œé»˜è®¤æ˜¯è®¤ä¸ºä¸ä¼šæœ‰å¤šä¸ªçº¿ç¨‹æŠ¢ç€ç”¨ï¼Œmark wordæ˜¯é€šè¿‡64bitæ¥è¡¨ç¤ºçš„ï¼Œé€šè¿‡æœ€ä½2ä½ä¹Ÿå°±æ˜¯é”æ ‡å¿—ä½ï¼Œåå‘é”ä¸æ— é”çš„å€¼æ˜¯01ï¼Œè½»é‡çº§é”ç”¨00è¡¨ç¤ºï¼Œé‡é‡çº§é”ç”¨10è¡¨ç¤ºï¼Œæ ‡è®°äº†GCçš„ç”¨11è¡¨ç¤ºï¼Œæ— é”ä¸åå‘é”ä½2ä½æ˜¯ä¸€è‡´çš„ï¼Œåœ¨å€’æ•°ç¬¬3ä½æœ‰1ä½æ¥è¡¨ç¤ºåå‘é”ä½ï¼šå€¼ä¸º1è¡¨ç¤ºåå‘é”ã€‚</p><p><img src="https://s2.loli.net/2023/06/21/Poki3GF5W2RDEHb.png" alt="image-20230613131954515.png"></p><h4 id="2-ã€é”å‡çº§æµç¨‹"><a href="#2-ã€é”å‡çº§æµç¨‹" class="headerlink" title="(2)ã€é”å‡çº§æµç¨‹"></a>(2)ã€é”å‡çº§æµç¨‹</h4><p>åœ¨Javaä¸­ï¼Œsynchronizedé”çš„çŠ¶æ€å¯ä»¥æ ¹æ®ç«äº‰æƒ…å†µè¿›è¡Œå‡çº§å’Œé™çº§,ç»“åˆä¸Šå›¾ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¸…æ™°çš„äº†è§£synchronizedåº•å±‚é”çš„çŠ¶æ€å˜åŒ–è¿‡ç¨‹ã€‚</p><p>åˆå§‹çŠ¶æ€ä¸‹ï¼Œå¯¹è±¡æ²¡æœ‰è¢«ä»»ä½•çº¿ç¨‹é”å®šï¼Œæ­¤æ—¶æ˜¯æ— çŠ¶æ€é”ï¼›å½“æœ‰ä¸€ä¸ªçº¿ç¨‹ç¬¬ä¸€æ¬¡è¿›å…¥synchronizedä»£ç å—æ—¶ï¼ŒJVMä¼šåå‘è¯¥çº¿ç¨‹ï¼Œå°†é”çš„å¯¹è±¡å¤´æ ‡è®°ä¸ºåå‘é”ï¼Œæ­¤æ—¶è¿˜ä¼šè®°å½•è¿™ä¸ªçº¿ç¨‹IDï¼Œèƒ½å¤Ÿç›´æ¥è¿›å…¥åŒæ­¥å—ï¼Œæ ‡è®°åå‘çº¿ç¨‹idæ˜¯ä¸ºäº†ç­‰ä¸‹æ¬¡çº¿ç¨‹è¿‡æ¥è®¿é—®çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œçº¿ç¨‹idæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒï¼Œå°±èƒ½å¤Ÿè·å–è¿™æŠŠé”ï¼›ç„¶è€Œï¼Œå½“å¤šä¸ªçº¿ç¨‹æ¥äº‰æŠ¢è¿™æŠŠé”ï¼Œè¿™æ—¶å€™å°±ä¼šè¿›è¡Œé”å‡çº§ï¼Œä¼šå°†åå‘é”å‡çº§ä¸ºè½»é‡çº§é”ï¼Œå®ƒä¼šä½¿ç”¨CASæ“ä½œæ¥å°è¯•å°†é”çš„å¯¹è±¡å¤´è®¾ç½®ä¸ºæŒ‡å‘é”è®°å½•ï¼ˆLock Recordï¼‰çš„æŒ‡é’ˆï¼Œå¦‚æœCASæˆåŠŸï¼Œå°±èƒ½å¤Ÿè·å¾—è¿™æŠŠé”ï¼Œå¦‚æœè·å¾—ä¸åˆ°ï¼Œä¼šé€šè¿‡è‡ªæ—‹ï¼›å½“è½»é‡çº§é”ç«äº‰å¤±è´¥æ—¶ï¼Œé”ä¼šå‡çº§ä¸ºé‡é‡çº§é”ã€‚æ­¤æ—¶ï¼ŒJVMä¼šä½¿ç”¨æ“ä½œç³»ç»Ÿçš„äº’æ–¥é‡ï¼ˆMutexï¼‰æ¥å®ç°é”çš„äº’æ–¥æ“ä½œã€‚é‡é‡çº§é”æ¶‰åŠåˆ°ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„åˆ‡æ¢ï¼Œå¼€é”€è¾ƒå¤§ã€‚</p><p><img src="https://s2.loli.net/2023/06/21/MG793bamDBesr1d.png" alt="image-20230611235859502.png"></p><h4 id="3-ã€è½»é‡çº§é”ä¸€å®šæ¯”é‡é‡çº§é”æ€§èƒ½é«˜å—ï¼Ÿ"><a href="#3-ã€è½»é‡çº§é”ä¸€å®šæ¯”é‡é‡çº§é”æ€§èƒ½é«˜å—ï¼Ÿ" class="headerlink" title="(3)ã€è½»é‡çº§é”ä¸€å®šæ¯”é‡é‡çº§é”æ€§èƒ½é«˜å—ï¼Ÿ"></a>(3)ã€è½»é‡çº§é”ä¸€å®šæ¯”é‡é‡çº§é”æ€§èƒ½é«˜å—ï¼Ÿ</h4><p>å½“çº¿ç¨‹è¶³å¤Ÿå¤šçš„æ—¶å€™ï¼Œå¦‚æœä½¿ç”¨è½»é‡çº§é”ï¼Œå¾ˆå¤šä¸ªçº¿ç¨‹ä¼šè‡ªæ—‹ï¼Œæ²¡æœ‰æˆåŠŸå°†ä¼šä¸€ç›´è‡ªæ—‹ï¼Œè¿™æ ·è¿˜ä¼šæ¶ˆè€—cpuï¼Œæ­¤æ—¶è¿˜ä¸å¦‚ç›´æ¥æ”¾åœ¨é˜Ÿåˆ—ä¸­ä½¿ç”¨é‡é‡çº§é”ã€‚æ€»çš„æ¥è¯´å¦‚æœç«äº‰ä¸æ¿€çƒˆï¼Œè½»é‡çº§é”å¯ä»¥æä¾›æ›´å¥½çš„æ€§èƒ½ã€‚è€Œåœ¨é«˜åº¦ç«äº‰çš„æƒ…å†µä¸‹ï¼Œé‡é‡çº§é”å¯èƒ½æ›´é€‚åˆï¼Œé¿å…äº†è‡ªæ—‹å’Œä¸æ–­é‡è¯•çš„å¼€é”€ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œéœ€è¦æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œè¯„ä¼°å’Œæµ‹è¯•ï¼Œé€‰æ‹©é€‚å½“çš„é”æœºåˆ¶ã€‚</p><h3 id="2ã€synchronizedé”å‡çº§çŠ¶æ€å˜åŒ–åŸç†"><a href="#2ã€synchronizedé”å‡çº§çŠ¶æ€å˜åŒ–åŸç†" class="headerlink" title="2ã€synchronizedé”å‡çº§çŠ¶æ€å˜åŒ–åŸç†"></a>2ã€synchronizedé”å‡çº§çŠ¶æ€å˜åŒ–åŸç†</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä»ä»£ç çš„å½¢å¼æ¥äº†è§£synchronizedé”çš„å‡çº§çŠ¶æ€å˜åŒ–ã€‚</p><p>å› ä¸ºä½¿ç”¨äº† javaå¯¹è±¡çš„å†…å­˜å¸ƒå±€ä»¥åŠä½¿ç”¨ClassLayoutæŸ¥çœ‹å¸ƒå±€,é¦–å…ˆéœ€è¦å¯¼å…¥ä¾èµ–, 0.13æ˜¯æ˜¾ç¤ºäºŒè¿›åˆ¶ï¼Œ0.17æœ€æ–°ç‰ˆæœ¬æ˜¯æ˜¾ç¤ºåå…­è¿›åˆ¶ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  javaå¯¹è±¡çš„å†…å­˜å¸ƒå±€ä»¥åŠä½¿ç”¨ClassLayoutæŸ¥çœ‹å¸ƒå±€  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.openjdk.jol<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jol-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨mainæ–¹æ³•ä¸­ï¼Œé€šè¿‡ClassLayoutæŸ¥çœ‹å¸ƒå±€ï¼Œè¿™é‡ŒUseråªæ˜¯å®šä¹‰çš„ä¸€ä¸ªå¯¹è±¡å®ä½“ï¼Œé‡Œé¢åŒ…å«idå’Œnameå±æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">userTemp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="comment">/*javaå¯¹è±¡çš„å†…å­˜å¸ƒå±€ä»¥åŠä½¿ç”¨ClassLayoutæŸ¥çœ‹å¸ƒå±€*/</span></span><br><span class="line">System.out.println(<span class="string">&quot;æ— çŠ¶æ€(001)ï¼š&quot;</span> + ClassLayout.parseInstance(userTemp).toPrintable());</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™æ®µä»£ç çš„è¾“å‡ºï¼Œå¯ä»¥å¯¹ç…§é”çš„çŠ¶æ€å›¾æ¥çœ‹ï¼Œè¿™äº›ä¿¡æ¯åŒ…å«å¯¹è±¡å¤´markï¼Œclassï¼Œè¿˜æœ‰å¯¹è±¡å±æ€§ï¼Œæœ€å4å­—èŠ‚æ˜¯å¯¹é½ä½ï¼Œå› ä¸ºä½æ•°æ˜¯8çš„æ•´æ•°å€ã€‚markç”±8ä¸ªå­—èŠ‚ï¼Œ64bitç»„æˆï¼Œä»¥ä¸‹æ˜¯åå…­è¿›åˆ¶ï¼Œæˆ‘ä»¬è½¬æ¢æˆäºŒè¿›åˆ¶ï¼š0â€¦..001å¯¹æ¯”é”çŠ¶æ€å›¾æ¥çœ‹æ˜¯æ— é”çŠ¶æ€ã€‚</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">æ— çŠ¶æ€(<span class="number">001</span>)ï¼šcn.lyd.test.service.user.dto.User <span class="keyword">object</span> internals:</span><br><span class="line">OFF  SZ               TYPE DESCRIPTION               VALUE</span><br><span class="line">  <span class="number">0</span>   <span class="number">8</span>                    (<span class="keyword">object</span> header: mark)     <span class="number">0</span>x<span class="number">0000000000000001</span> (non-biasable; age: <span class="number">0</span>)</span><br><span class="line">  <span class="number">8</span>   <span class="number">4</span>                    (<span class="keyword">object</span> header: <span class="keyword">class</span>)    <span class="number">0</span>xf<span class="number">800</span>c<span class="number">143</span></span><br><span class="line"> <span class="number">12</span>   <span class="number">4</span>                int User.id                   <span class="number">0</span></span><br><span class="line"> <span class="number">16</span>   <span class="number">4</span>   java.lang.String User.name                 null</span><br><span class="line"> <span class="number">20</span>   <span class="number">4</span>                    (<span class="keyword">object</span> alignment gap)    </span><br><span class="line">Instance size: <span class="number">24</span> bytes</span><br><span class="line">Space losses: <span class="number">0</span> bytes internal + <span class="number">4</span> bytes external = <span class="number">4</span> bytes total</span><br></pre></td></tr></table></figure><p>å…ˆç»™å‡ºå…¨éƒ¨ä»£ç ï¼Œåé¢é’ˆå¯¹ä»£ç è¿›è¡Œè§£æï¼Œé€šè¿‡è¿™æ®µä»£ç ï¼Œå°±èƒ½å¤Ÿæ¸…æ™°çœ‹è§é”æ˜¯å¦‚ä½•å‡çº§çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: lyd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: synchronizedé”å‡çº§çŠ¶æ€å˜åŒ–</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2023/6/11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LockUpgrade</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123; <span class="comment">// ä¸»çº¿ç¨‹</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">userTemp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        <span class="comment">/*javaå¯¹è±¡çš„å†…å­˜å¸ƒå±€ä»¥åŠä½¿ç”¨ClassLayoutæŸ¥çœ‹å¸ƒå±€*/</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ— çŠ¶æ€(001)ï¼š&quot;</span> + ClassLayout.parseInstance(userTemp).toPrintable());</span><br><span class="line">        <span class="comment">// jvmé»˜è®¤å»¶è¿Ÿ4sè‡ªåŠ¨å¼€æœºåå‘é”ï¼Œå¯ä»¥é€šè¿‡-XX:BiasedLockingStartupDelay = 0 å–æ¶ˆå»¶è¿Ÿ</span></span><br><span class="line">        <span class="comment">// å¦‚æœä¸éœ€è¦åå‘é”ï¼Œä½¿ç”¨-XX:- UseBiasedLocking = false å…³é—­</span></span><br><span class="line">        <span class="comment">// -&gt; ä¸€å¼€å§‹æ˜¯ä¸ä¼šè‡ªåŠ¨ä½¿ç”¨åå‘é”çš„ï¼Œå¦‚æœä¸€å¼€å§‹å°±ä½¿ç”¨synchronizedé”ï¼Œå°±ä¼šç›´æ¥ä½¿ç”¨é‡é‡çº§é”ï¼Œjvmä¸­éœ€è¦å»¶è¿Ÿ4sæ‰èƒ½å¤Ÿå¼€å¯åå‘é”ã€‚æ‰€ä»¥è¿™é‡Œå»¶è¿Ÿäº†5s</span></span><br><span class="line">        Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        <span class="comment">// åå‘é”è®¤ä¸ºä¸€å¼€å§‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ¥è®¿é—®</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(); <span class="comment">// é‡æ–°newä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">        System.out.println(<span class="string">&quot;å¯ç”¨åå‘é”(101)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (user) &#123; <span class="comment">// åŠ ä¸Šåå‘é”</span></span><br><span class="line">                System.out.println(<span class="string">&quot;åå‘é”(101)(å¸¦çº¿ç¨‹ID)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// è™½ç„¶è¿™é‡Œä¼šé‡Šæ”¾åå‘é”ï¼Œä½†å®é™…ä¸Šä¸ä¼šä¸»åŠ¨é‡Šæ”¾ï¼Œå¤´éƒ¨ï¼ˆé«˜54ä½ï¼‰æ˜¯ä¸ä¼šåšä¿®æ”¹çš„ï¼Œè¿™äº›æ•°å€¼ä»£è¡¨å±äºå“ªä¸ªçº¿ç¨‹</span></span><br><span class="line">            <span class="comment">// åœ¨åå‘é”ä¸­ï¼Œé«˜54ä½æ¥æ ‡è¯†çº¿ç¨‹idï¼Œä¸»è¦æ˜¯å¦‚æœåŒä¸ªçº¿ç¨‹è¿‡æ¥çš„ï¼Œå°±ç›´æ¥èµ°è¿™ä¸ªåå‘é”</span></span><br><span class="line">            System.out.println(<span class="string">&quot;é‡Šæ”¾åå‘é”(101)(å¸¦çº¿ç¨‹ID)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123; <span class="comment">// å¤šä¸ªçº¿ç¨‹ç«äº‰ï¼Œå¯èƒ½å‡çº§ä¸ºè½»é‡çº§é”</span></span><br><span class="line">            <span class="keyword">synchronized</span> (user) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;è½»é‡çº§é”(00)(å¸¦çº¿ç¨‹ID)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;ç¡çœ 3ç§’é’Ÿ==========================================&quot;</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">&quot;è½»é‡çº§é”å‡çº§é‡é‡çº§é”(10)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        <span class="comment">// å¼€å¯æ–°çš„çº¿ç¨‹, ç¬¬ä¸€ä¸ªçº¿ç¨‹è¿˜åœ¨ç¡çœ ä¸­ï¼Œæ„å‘³ç€çº¿ç¨‹è¿˜æ²¡æœ‰ç»“æŸï¼Œæ­¤æ—¶ç¬¬äºŒä¸ªçº¿ç¨‹å°±æ‰§è¡Œäº†ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å¤šä¸ªçº¿ç¨‹çš„è®¿é—®ï¼Œè¿™æ˜¯å°±ä¼šå‡çº§ä½é‡é‡çº§é”</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (user) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;é‡é‡çº§é”(10)(å¸¦çº¿ç¨‹ID)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç è§£æï¼š</p><p>é¦–å…ˆæ˜¯æ— é”çš„çŠ¶æ€ï¼Œè¿™ä¸ªåœ¨å‰é¢å·²ç»ä»‹ç»äº†ï¼Œç°åœ¨å°±ä¸å†ç»§ç»­èµ˜è¿°ã€‚æˆ‘ä»¬è¦çŸ¥é“ï¼Œjvmé»˜è®¤æ˜¯å»¶è¿Ÿ4sæ‰è‡ªåŠ¨å¼€æœºåå‘é”ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>-XX:BiasedLockingStartupDelay = 0</code> å–æ¶ˆå»¶è¿Ÿã€‚</p><p>ä¸€å¼€å§‹æ˜¯ä¸ä¼šè‡ªåŠ¨ä½¿ç”¨åå‘é”çš„ï¼Œå¦‚æœä¸€å¼€å§‹å°±ä½¿ç”¨synchronizedé”ï¼Œå°±ä¼šç›´æ¥ä½¿ç”¨é‡é‡çº§é”ï¼Œjvmä¸­éœ€è¦å»¶è¿Ÿ4sæ‰èƒ½å¤Ÿå¼€å¯åå‘é”ã€‚æ‰€ä»¥è¿™é‡Œå»¶è¿Ÿäº†5sã€‚</p><p>é‡æ–°newä¸€ä¸ªå¯¹è±¡ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹å¯ç”¨äº†åå‘é”ï¼Œæ³¨æ„ï¼Œè¿™é‡Œè™½ç„¶è¿˜æ²¡æœ‰ä¸Šé”ï¼Œä½†æ˜¯é”çš„ä½¿ç”¨æ˜¯éœ€è¦å…ˆå¼€å¯é”çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(); <span class="comment">// é‡æ–°newä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">System.out.println(<span class="string">&quot;å¯ç”¨åå‘é”(101)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹æ§åˆ¶å°çš„è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°å¤´éƒ¨markä¿¡æ¯ï¼Œè½¬æ¢äºŒè¿›åˆ¶å°±æ˜¯000â€¦â€¦.0101ï¼Œè¿™å¯ä»¥çœ‹åˆ°åå‘é”å°±å·²ç»å¯ç”¨äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è§‚å¯Ÿåˆ°åå‘çº¿ç¨‹idçš„54bitéƒ½æ˜¯0ï¼Œæ˜¾ç„¶è¿™æ—¶å€™è¿˜æ²¡æœ‰ä¸Šé”ï¼Œåªæ˜¯å¼€å¯äº†åå‘é”è€Œå·²ã€‚</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">å¯ç”¨åå‘é”(<span class="number">101</span>)ï¼šcn.lyd.test.service.user.dto.User <span class="keyword">object</span> internals:</span><br><span class="line">OFF  SZ               TYPE DESCRIPTION               VALUE</span><br><span class="line">  <span class="number">0</span>   <span class="number">8</span>                    (<span class="keyword">object</span> header: mark)     <span class="number">0</span>x<span class="number">0000000000000005</span> (biasable; age: <span class="number">0</span>)</span><br><span class="line">  <span class="number">8</span>   <span class="number">4</span>                    (<span class="keyword">object</span> header: <span class="keyword">class</span>)    <span class="number">0</span>xf<span class="number">800</span>c<span class="number">143</span></span><br><span class="line"> <span class="number">12</span>   <span class="number">4</span>                int User.id                   <span class="number">0</span></span><br><span class="line"> <span class="number">16</span>   <span class="number">4</span>   java.lang.String User.name                 null</span><br><span class="line"> <span class="number">20</span>   <span class="number">4</span>                    (<span class="keyword">object</span> alignment gap)    </span><br><span class="line">Instance size: <span class="number">24</span> bytes</span><br><span class="line">Space losses: <span class="number">0</span> bytes internal + <span class="number">4</span> bytes external = <span class="number">4</span> bytes total</span><br></pre></td></tr></table></figure><p>é€šè¿‡forå¾ªç¯ï¼Œä¸»çº¿ç¨‹ä¸¤æ¬¡è®¿é—®userè¿™æŠŠé”ï¼Œæ­¤æ—¶å¯åŠ¨çš„æ˜¯åå‘é”ï¼Œè¿™é‡Œæ˜¯æºå¸¦äº†çº¿ç¨‹idï¼Œåœ¨åå‘é”ä¸­ï¼Œé«˜54ä½æ¥æ ‡è¯†çº¿ç¨‹idï¼Œä¸»è¦æ˜¯å¦‚æœåŒä¸ªçº¿ç¨‹è¿‡æ¥çš„ï¼Œå°±ç›´æ¥èµ°è¿™ä¸ªåå‘é”ã€‚è¾“å‡ºå®Œåé‡Šæ”¾åå‘é”ï¼Œå®é™…ä¸Šä¸ä¼šä¸»åŠ¨é‡Šæ”¾ï¼Œå¤´éƒ¨é«˜54ä½å¹¶æ²¡æœ‰åšä¿®æ”¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (user) &#123; <span class="comment">// åŠ ä¸Šåå‘é”</span></span><br><span class="line">        System.out.println(<span class="string">&quot;åå‘é”(101)(å¸¦çº¿ç¨‹ID)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è™½ç„¶è¿™é‡Œä¼šé‡Šæ”¾åå‘é”ï¼Œä½†å®é™…ä¸Šä¸ä¼šä¸»åŠ¨é‡Šæ”¾ï¼Œå¤´éƒ¨ï¼ˆé«˜54ä½ï¼‰æ˜¯ä¸ä¼šåšä¿®æ”¹çš„ï¼Œè¿™äº›æ•°å€¼ä»£è¡¨å±äºå“ªä¸ªçº¿ç¨‹</span></span><br><span class="line">    <span class="comment">// åœ¨åå‘é”ä¸­ï¼Œé«˜54ä½æ¥æ ‡è¯†çº¿ç¨‹idï¼Œä¸»è¦æ˜¯å¦‚æœåŒä¸ªçº¿ç¨‹è¿‡æ¥çš„ï¼Œå°±ç›´æ¥èµ°è¿™ä¸ªåå‘é”</span></span><br><span class="line">    System.out.println(<span class="string">&quot;é‡Šæ”¾åå‘é”(101)(å¸¦çº¿ç¨‹ID)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ˜¯ä¸»çº¿ç¨‹æ¥ä¸¤æ¬¡è®¿é—®ï¼Œçº¿ç¨‹idéƒ½æ˜¯ç›¸åŒçš„ï¼Œæ ¹æ®å¤´markçš„äºŒè¿›åˆ¶å¯ä»¥è§£å‡ºçº¿ç¨‹idï¼š000â€¦.001100111111010100è¿™æ˜¯å°†0x00000000033f5005è½¬æ¢æˆäºŒè¿›åˆ¶ï¼Œå–é«˜54ä½çš„æ¥ã€‚</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">åå‘é”(<span class="number">101</span>)(å¸¦çº¿ç¨‹ID)ï¼šcn.lyd.test.service.user.dto.User <span class="keyword">object</span> internals:</span><br><span class="line">OFF  SZ               TYPE DESCRIPTION               VALUE</span><br><span class="line">  <span class="number">0</span>   <span class="number">8</span>                    (<span class="keyword">object</span> header: mark)     <span class="number">0</span>x<span class="number">00000000033f</span><span class="number">5005</span> (biased: <span class="number">0</span>x<span class="number">000000000000</span>cfd<span class="number">4</span>; epoch: <span class="number">0</span>; age: <span class="number">0</span>)</span><br><span class="line">  <span class="number">8</span>   <span class="number">4</span>                    (<span class="keyword">object</span> header: <span class="keyword">class</span>)    <span class="number">0</span>xf<span class="number">800</span>c<span class="number">143</span></span><br><span class="line"> <span class="number">12</span>   <span class="number">4</span>                int User.id                   <span class="number">0</span></span><br><span class="line"> <span class="number">16</span>   <span class="number">4</span>   java.lang.String User.name                 null</span><br><span class="line"> <span class="number">20</span>   <span class="number">4</span>                    (<span class="keyword">object</span> alignment gap)    </span><br><span class="line">Instance size: <span class="number">24</span> bytes</span><br><span class="line">Space losses: <span class="number">0</span> bytes internal + <span class="number">4</span> bytes external = <span class="number">4</span> bytes total</span><br><span class="line"></span><br><span class="line">é‡Šæ”¾åå‘é”(<span class="number">101</span>)(å¸¦çº¿ç¨‹ID)ï¼šcn.lyd.test.service.user.dto.User <span class="keyword">object</span> internals:</span><br><span class="line">OFF  SZ               TYPE DESCRIPTION               VALUE</span><br><span class="line">  <span class="number">0</span>   <span class="number">8</span>                    (<span class="keyword">object</span> header: mark)     <span class="number">0</span>x<span class="number">00000000033f</span><span class="number">5005</span> (biased: <span class="number">0</span>x<span class="number">000000000000</span>cfd<span class="number">4</span>; epoch: <span class="number">0</span>; age: <span class="number">0</span>)</span><br><span class="line">  <span class="number">8</span>   <span class="number">4</span>                    (<span class="keyword">object</span> header: <span class="keyword">class</span>)    <span class="number">0</span>xf<span class="number">800</span>c<span class="number">143</span></span><br><span class="line"> <span class="number">12</span>   <span class="number">4</span>                int User.id                   <span class="number">0</span></span><br><span class="line"> <span class="number">16</span>   <span class="number">4</span>   java.lang.String User.name                 null</span><br><span class="line"> <span class="number">20</span>   <span class="number">4</span>                    (<span class="keyword">object</span> alignment gap)    </span><br><span class="line">Instance size: <span class="number">24</span> bytes</span><br><span class="line">Space losses: <span class="number">0</span> bytes internal + <span class="number">4</span> bytes external = <span class="number">4</span> bytes total</span><br><span class="line"></span><br><span class="line">åå‘é”(<span class="number">101</span>)(å¸¦çº¿ç¨‹ID)ï¼šcn.lyd.test.service.user.dto.User <span class="keyword">object</span> internals:</span><br><span class="line">OFF  SZ               TYPE DESCRIPTION               VALUE</span><br><span class="line">  <span class="number">0</span>   <span class="number">8</span>                    (<span class="keyword">object</span> header: mark)     <span class="number">0</span>x<span class="number">00000000033f</span><span class="number">5005</span> (biased: <span class="number">0</span>x<span class="number">000000000000</span>cfd<span class="number">4</span>; epoch: <span class="number">0</span>; age: <span class="number">0</span>)</span><br><span class="line">  <span class="number">8</span>   <span class="number">4</span>                    (<span class="keyword">object</span> header: <span class="keyword">class</span>)    <span class="number">0</span>xf<span class="number">800</span>c<span class="number">143</span></span><br><span class="line"> <span class="number">12</span>   <span class="number">4</span>                int User.id                   <span class="number">0</span></span><br><span class="line"> <span class="number">16</span>   <span class="number">4</span>   java.lang.String User.name                 null</span><br><span class="line"> <span class="number">20</span>   <span class="number">4</span>                    (<span class="keyword">object</span> alignment gap)    </span><br><span class="line">Instance size: <span class="number">24</span> bytes</span><br><span class="line">Space losses: <span class="number">0</span> bytes internal + <span class="number">4</span> bytes external = <span class="number">4</span> bytes total</span><br><span class="line"></span><br><span class="line">é‡Šæ”¾åå‘é”(<span class="number">101</span>)(å¸¦çº¿ç¨‹ID)ï¼šcn.lyd.test.service.user.dto.User <span class="keyword">object</span> internals:</span><br><span class="line">OFF  SZ               TYPE DESCRIPTION               VALUE</span><br><span class="line">  <span class="number">0</span>   <span class="number">8</span>                    (<span class="keyword">object</span> header: mark)     <span class="number">0</span>x<span class="number">00000000033f</span><span class="number">5005</span> (biased: <span class="number">0</span>x<span class="number">000000000000</span>cfd<span class="number">4</span>; epoch: <span class="number">0</span>; age: <span class="number">0</span>)</span><br><span class="line">  <span class="number">8</span>   <span class="number">4</span>                    (<span class="keyword">object</span> header: <span class="keyword">class</span>)    <span class="number">0</span>xf<span class="number">800</span>c<span class="number">143</span></span><br><span class="line"> <span class="number">12</span>   <span class="number">4</span>                int User.id                   <span class="number">0</span></span><br><span class="line"> <span class="number">16</span>   <span class="number">4</span>   java.lang.String User.name                 null</span><br><span class="line"> <span class="number">20</span>   <span class="number">4</span>                    (<span class="keyword">object</span> alignment gap)    </span><br><span class="line">Instance size: <span class="number">24</span> bytes</span><br><span class="line">Space losses: <span class="number">0</span> bytes internal + <span class="number">4</span> bytes external = <span class="number">4</span> bytes total</span><br></pre></td></tr></table></figure><p>åˆšåˆšè·‘çš„æ˜¯ä¸»çº¿ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œä½¿å¾—å¤šä¸ªçº¿ç¨‹ç«äº‰ï¼Œè¿™å°±å¯èƒ½å°†åå‘é”å‡çº§ä¸ºè½»é‡çº§é”ã€‚å½“çº¿ç¨‹è·å–åˆ°è½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹è¿›æ¥ä¼šæ‹¿ä¸åˆ°ï¼Œæ­¤æ—¶ä¼šè‡ªæ—‹ã€‚è¿™é‡Œæˆ‘ä»¬ç¡çœ 3sï¼Œæ¥æ¨¡æ‹Ÿçº¿ç¨‹ç´§æ¡é”ä¸æ”¾ï¼Œè¿™æ—¶å€™æˆ‘ä»¬åœ¨å¼€ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œè¿˜æ˜¯æ¥äº‰æŠ¢userè¿™æŠŠé”ï¼Œè¿™å°±å¯¼è‡´CASè‡ªæ—‹å¤±è´¥ï¼Œé”è†¨èƒ€å°±ä¼šå°†è½»é‡çº§é”å‡çº§ä¸ºé‡é‡çº§é”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123; <span class="comment">// å¤šä¸ªçº¿ç¨‹ç«äº‰ï¼Œå¯èƒ½å‡çº§ä¸ºè½»é‡çº§é”</span></span><br><span class="line">    <span class="keyword">synchronized</span> (user) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è½»é‡çº§é”(00)(å¸¦çº¿ç¨‹ID)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç¡çœ 3ç§’é’Ÿ==========================================&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;è½»é‡çº§é”å‡çº§é‡é‡çº§é”(10)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).start();</span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"><span class="comment">// å¼€å¯æ–°çš„çº¿ç¨‹, ç¬¬ä¸€ä¸ªçº¿ç¨‹è¿˜åœ¨ç¡çœ ä¸­ï¼Œæ„å‘³ç€çº¿ç¨‹è¿˜æ²¡æœ‰ç»“æŸï¼Œæ­¤æ—¶ç¬¬äºŒä¸ªçº¿ç¨‹å°±æ‰§è¡Œäº†ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å¤šä¸ªçº¿ç¨‹çš„è®¿é—®ï¼Œè¿™æ˜¯å°±ä¼šå‡çº§ä½é‡é‡çº§é”</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (user) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é‡é‡çº§é”(10)(å¸¦çº¿ç¨‹ID)ï¼š&quot;</span> + ClassLayout.parseInstance(user).toPrintable());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).start();</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸‹æ—¥å¿—ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¤´markè½¬æ¢æˆäºŒè¿›åˆ¶ï¼Œå–æœ€åä¸¤ä½é”æ ‡è®°ä½ï¼Œèƒ½å¤Ÿæ¸…æ™°çœ‹åˆ°è½»é‡çº§é”å‡çº§åˆ°é‡é‡çº§é”ã€‚</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">è½»é‡çº§é”(<span class="number">00</span>)(å¸¦çº¿ç¨‹ID)ï¼šcn.lyd.test.service.user.dto.User <span class="keyword">object</span> internals:</span><br><span class="line">OFF  SZ               TYPE DESCRIPTION               VALUE</span><br><span class="line">  <span class="number">0</span>   <span class="number">8</span>                    (<span class="keyword">object</span> header: mark)     <span class="number">0</span>x<span class="number">000000002</span>a<span class="number">11</span>ef<span class="number">08</span> (thin lock: <span class="number">0</span>x<span class="number">000000002</span>a<span class="number">11</span>ef<span class="number">08</span>)</span><br><span class="line">  <span class="number">8</span>   <span class="number">4</span>                    (<span class="keyword">object</span> header: <span class="keyword">class</span>)    <span class="number">0</span>xf<span class="number">800</span>c<span class="number">143</span></span><br><span class="line"> <span class="number">12</span>   <span class="number">4</span>                int User.id                   <span class="number">0</span></span><br><span class="line"> <span class="number">16</span>   <span class="number">4</span>   java.lang.String User.name                 null</span><br><span class="line"> <span class="number">20</span>   <span class="number">4</span>                    (<span class="keyword">object</span> alignment gap)    </span><br><span class="line">Instance size: <span class="number">24</span> bytes</span><br><span class="line">Space losses: <span class="number">0</span> bytes internal + <span class="number">4</span> bytes external = <span class="number">4</span> bytes total</span><br><span class="line"></span><br><span class="line">ç¡çœ <span class="number">3</span>ç§’é’Ÿ==========================================</span><br><span class="line">è½»é‡çº§é”å‡çº§é‡é‡çº§é”(<span class="number">10</span>)ï¼šcn.lyd.test.service.user.dto.User <span class="keyword">object</span> internals:</span><br><span class="line">OFF  SZ               TYPE DESCRIPTION               VALUE</span><br><span class="line">  <span class="number">0</span>   <span class="number">8</span>                    (<span class="keyword">object</span> header: mark)     <span class="number">0</span>x<span class="number">0000000024232f</span><span class="number">6</span>a (fat lock: <span class="number">0</span>x<span class="number">0000000024232f</span><span class="number">6</span>a)</span><br><span class="line">  <span class="number">8</span>   <span class="number">4</span>                    (<span class="keyword">object</span> header: <span class="keyword">class</span>)    <span class="number">0</span>xf<span class="number">800</span>c<span class="number">143</span></span><br><span class="line"> <span class="number">12</span>   <span class="number">4</span>                int User.id                   <span class="number">0</span></span><br><span class="line"> <span class="number">16</span>   <span class="number">4</span>   java.lang.String User.name                 null</span><br><span class="line"> <span class="number">20</span>   <span class="number">4</span>                    (<span class="keyword">object</span> alignment gap)    </span><br><span class="line">Instance size: <span class="number">24</span> bytes</span><br><span class="line">Space losses: <span class="number">0</span> bytes internal + <span class="number">4</span> bytes external = <span class="number">4</span> bytes total</span><br><span class="line">    </span><br><span class="line">é‡é‡çº§é”(<span class="number">10</span>)(å¸¦çº¿ç¨‹ID)ï¼šcn.lyd.test.service.user.dto.User <span class="keyword">object</span> internals:</span><br><span class="line">OFF  SZ               TYPE DESCRIPTION               VALUE</span><br><span class="line">  <span class="number">0</span>   <span class="number">8</span>                    (<span class="keyword">object</span> header: mark)     <span class="number">0</span>x<span class="number">0000000024232f</span><span class="number">6</span>a (fat lock: <span class="number">0</span>x<span class="number">0000000024232f</span><span class="number">6</span>a)</span><br><span class="line">  <span class="number">8</span>   <span class="number">4</span>                    (<span class="keyword">object</span> header: <span class="keyword">class</span>)    <span class="number">0</span>xf<span class="number">800</span>c<span class="number">143</span></span><br><span class="line"> <span class="number">12</span>   <span class="number">4</span>                int User.id                   <span class="number">0</span></span><br><span class="line"> <span class="number">16</span>   <span class="number">4</span>   java.lang.String User.name                 null</span><br><span class="line"> <span class="number">20</span>   <span class="number">4</span>                    (<span class="keyword">object</span> alignment gap)    </span><br><span class="line">Instance size: <span class="number">24</span> bytes</span><br><span class="line">Space losses: <span class="number">0</span> bytes internal + <span class="number">4</span> bytes external = <span class="number">4</span> bytes total</span><br></pre></td></tr></table></figure><h2 id="æ–‡ç« èµ„æ–™"><a href="#æ–‡ç« èµ„æ–™" class="headerlink" title="æ–‡ç« èµ„æ–™"></a>æ–‡ç« èµ„æ–™</h2><p><a href="https://zhuanlan.zhihu.com/p/160185717">https://zhuanlan.zhihu.com/p/160185717</a></p><p><a href="https://juejin.cn/post/6978882583492821023">https://juejin.cn/post/6978882583492821023</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ã€å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘ã€‘-é”çš„æœºåˆ¶ä¸åº•å±‚ä¼˜åŒ–åŸç†&quot;&gt;&lt;a href=&quot;#ã€å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘ã€‘-é”çš„æœºåˆ¶ä¸åº•å±‚ä¼˜åŒ–åŸç†&quot; class=&quot;headerlink&quot; title=&quot;ã€å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘ã€‘- é”çš„æœºåˆ¶ä¸åº•å±‚ä¼˜åŒ–åŸç†&quot;&gt;&lt;/a&gt;ã€å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘ã€‘- é”çš„æœºåˆ¶ä¸åº•å±‚ä¼˜åŒ–åŸç†</summary>
      
    
    
    
    
    <category term="å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘" scheme="https://lydandtry.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
</feed>
